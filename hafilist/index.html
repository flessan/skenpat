<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hafilist - Atur-Keuangan Pribadi</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Poppins Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* Enhanced Color Palette */
        :root {
            --primary-color: #F46900;
            --primary-light: #FF8A4C;
            --primary-dark: #D55800;
            --secondary-color: #4ECDC4;
            --accent-color: #FFD166;
            --dark-color: #0a0a0a;
            --darker-color: #050505;
            --light-dark: #1a1a1a;
            --card-dark: #1E1E1E;
            --card-light: #2A2A2A;
            --card-hover: #333333;
            --text-light: #f0f0f0;
            --text-muted: #aaa;
            --text-dim: #777;
            --success-color: #4CAF50;
            --info-color: #2196F3;
            --warning-color: #FFC107;
            --danger-color: #F44336;
            
            /* Light mode colors */
            --light-bg: #f5f5f5;
            --light-card: #ffffff;
            --light-text: #333333;
            --light-text-muted: #666666;
            --light-border: rgba(0, 0, 0, 0.1);
            
            /* Transitions & Animations */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s ease;
            --transition-slow: all 0.5s ease;
            
            /* Spacing */
            --container-max-width: 1200px;
            --content-max-width: 800px;
            --section-gap: 2rem;
            --card-padding: 1.5rem;
            --border-radius: 16px;
            --border-radius-lg: 20px;
            
            /* Shadows */
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.4);
            --shadow-primary: 0 8px 24px rgba(244, 105, 0, 0.3);
            --shadow-secondary: 0 8px 24px rgba(78, 205, 196, 0.2);
            
            /* Light mode shadows */
            --light-shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.08);
            --light-shadow-md: 0 8px 24px rgba(0, 0, 0, 0.1);
            --light-shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.15);
            
            /* Mobile-specific */
            --bottom-nav-height: 70px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Poppins', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark-color);
            color: var(--text-light);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            transition: background-color 0.3s ease, color 0.3s ease;
            padding-bottom: var(--bottom-nav-height);
        }

        /* Light mode styles */
        [data-theme="light"] body {
            background: var(--light-bg);
            color: var(--light-text);
        }

        /* Enhanced Animated Background */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(244, 105, 0, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(78, 205, 196, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 209, 102, 0.05) 0%, transparent 40%);
            z-index: -1;
            pointer-events: none;
        }

        [data-theme="light"] body::before {
            background: 
                radial-gradient(circle at 20% 50%, rgba(244, 105, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(78, 205, 196, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 209, 102, 0.05) 0%, transparent 40%);
        }

        a { 
            text-decoration: none; 
            color: inherit; 
            transition: var(--transition-fast);
        }

        /* Focus visible for accessibility */
        *:focus-visible {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* ================================
           LAYOUT CONTAINERS
           ================================ */

        .app-container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .app {
            width: 100%;
            max-width: var(--container-max-width);
            padding: 1rem;
            margin: 0 auto;
        }

        .content-wrapper {
            max-width: var(--content-max-width);
            margin: 0 auto;
            width: 100%;
        }

        /* ================================
           ENHANCED NAVIGATION
           ================================ */

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 0.75rem 0;
            transition: var(--transition);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        [data-theme="light"] .navbar {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .navbar.scrolled {
            padding: 0.5rem 0;
            background: rgba(10, 10, 10, 0.98);
        }

        [data-theme="light"] .navbar.scrolled {
            background: rgba(255, 255, 255, 0.98);
        }

        .navbar-container {
            max-width: var(--container-max-width);
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary-color);
        }

        .navbar-logo img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .navbar-menu {
            display: flex;
            gap: 1rem;
            list-style: none;
        }

        .navbar-menu a {
            color: var(--text-light);
            font-weight: 500;
            position: relative;
            padding: 0.5rem 0;
            font-size: 0.9rem;
        }

        [data-theme="light"] .navbar-menu a {
            color: var(--light-text);
        }

        .navbar-menu a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-color);
            transition: width 0.3s;
        }

        .navbar-menu a:hover::after {
            width: 100%;
        }

        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .navbar-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
        }

        [data-theme="light"] .navbar-toggle {
            color: var(--light-text);
        }

        /* Theme toggle button */
        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            color: var(--primary-color);
            background: rgba(244, 105, 0, 0.1);
        }

        [data-theme="light"] .theme-toggle {
            color: var(--light-text);
        }

        [data-theme="light"] .theme-toggle:hover {
            color: var(--primary-color);
            background: rgba(244, 105, 0, 0.1);
        }

        /* ================================
           ENHANCED HEADER
           ================================ */

        .header {
            text-align: center;
            margin: 4.5rem 0 2rem;
            position: relative;
            padding-bottom: 1rem;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 2px;
        }

        .header-badge {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 30px;
            margin-bottom: 0.75rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .header h1 {
            font-size: clamp(2rem, 6vw, 3.5rem);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 0.5rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            line-height: 1.1;
        }

        .header p {
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            opacity: 0.85;
            color: var(--text-muted);
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto;
        }

        [data-theme="light"] .header p {
            color: var(--light-text-muted);
        }

        /* ================================
           ENHANCED BALANCE CARD
           ================================ */

        .card-balance {
            background: linear-gradient(135deg, var(--card-dark), var(--card-light));
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg), var(--shadow-primary);
            border: 1px solid rgba(255,255,255,0.08);
            transition: var(--transition);
        }

        [data-theme="light"] .card-balance {
            background: linear-gradient(135deg, var(--light-card), #f0f0f0);
            border: 1px solid var(--light-border);
            box-shadow: var(--light-shadow-lg);
        }

        .card-balance:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5), 0 10px 20px rgba(244, 105, 0, 0.3);
        }

        [data-theme="light"] .card-balance:hover {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15), 0 10px 20px rgba(244, 105, 0, 0.2);
        }

        /* Enhanced Decorative elements */
        .card-balance::before,
        .card-balance::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
        }

        .card-balance::before {
            top: -50px; 
            right: -50px;
            width: 200px; 
            height: 200px;
            background: radial-gradient(circle, rgba(244, 105, 0, 0.2) 0%, transparent 70%);
            animation: pulse 5s infinite alternate;
        }

        .card-balance::after {
            bottom: -40px; 
            left: -40px;
            width: 150px; 
            height: 150px;
            background: radial-gradient(circle, rgba(78, 205, 196, 0.15) 0%, transparent 70%);
            animation: pulse 5s infinite alternate-reverse;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.2; }
            100% { transform: scale(1.15); opacity: 0.35; }
        }

        .card-balance h2 {
            font-size: clamp(1.75rem, 5vw, 2.5rem);
            margin-bottom: 0.5rem;
            font-weight: 700;
            color: var(--text-light);
            position: relative;
            z-index: 1;
        }

        [data-theme="light"] .card-balance h2 {
            color: var(--light-text);
        }

        .card-balance .coins {
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            opacity: 0.85;
            margin-bottom: 1.5rem;
            color: var(--text-muted);
            position: relative;
            z-index: 1;
        }

        [data-theme="light"] .card-balance .coins {
            color: var(--light-text-muted);
        }

        .card-balance .actions {
            display: flex;
            gap: 1rem;
            position: relative;
            z-index: 1;
            flex-wrap: wrap;
        }

        .card-balance .actions a {
            flex: 1;
            min-width: 140px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 12px;
            padding: 1rem 1.25rem;
            color: #fff;
            font-size: clamp(0.9rem, 2vw, 1rem);
            font-weight: 600;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-primary);
            transition: var(--transition);
            cursor: pointer;
        }

        .card-balance .actions a:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(244, 105, 0, 0.4);
        }

        .card-balance .actions a:active {
            transform: translateY(0);
            filter: brightness(0.95);
        }

        .card-balance .actions a::before {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .card-balance .actions a:hover::before {
            transform: translateX(100%);
        }

        /* ================================
           ENHANCED SECTIONS
           ================================ */

        .section {
            margin-bottom: var(--section-gap);
            animation: fadeInUp 0.7s backwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section:nth-child(3) { animation-delay: 0.1s; }
        .section:nth-child(4) { animation-delay: 0.2s; }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            padding: 0 0.25rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .section-header h3 {
            font-size: clamp(1.25rem, 3.5vw, 1.75rem);
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-header h3 i {
            color: var(--primary-color);
            background: rgba(244, 105, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .section-header a {
            font-size: clamp(0.85rem, 2vw, 0.95rem);
            color: var(--primary-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
            padding: 0.4rem 0.8rem;
            border-radius: 30px;
            background: rgba(244, 105, 0, 0.1);
            transition: var(--transition);
        }

        .section-header a:hover {
            background: rgba(244, 105, 0, 0.2);
            color: var(--primary-light);
        }

        /* ================================
           ENHANCED GRID BUTTONS
           ================================ */

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 1rem;
        }

        .grid .btn {
            background: linear-gradient(135deg, var(--card-dark), var(--card-light));
            border-radius: var(--border-radius);
            padding: 1.25rem 0.75rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            min-height: 120px;
        }

        [data-theme="light"] .grid .btn {
            background: linear-gradient(135deg, var(--light-card), #f0f0f0);
            border: 1px solid var(--light-border);
            box-shadow: var(--light-shadow-md);
        }

        .grid .btn:hover {
            background: linear-gradient(135deg, var(--card-hover), #3a3a3a);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border-color: rgba(244, 105, 0, 0.3);
        }

        [data-theme="light"] .grid .btn:hover {
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .grid .btn:active {
            transform: translateY(0);
            filter: brightness(0.95);
        }

        .grid .btn .icon {
            font-size: clamp(1.75rem, 4vw, 2.25rem);
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-muted);
            transition: var(--transition);
            background: rgba(244, 105, 0, 0.1);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        [data-theme="light"] .grid .btn .icon {
            color: var(--light-text-muted);
        }

        .grid .btn:hover .icon {
            transform: scale(1.1);
            color: var(--primary-color);
            background: rgba(244, 105, 0, 0.2);
        }

        .grid .btn span {
            display: block;
            color: var(--text-light);
            font-size: clamp(0.85rem, 2vw, 0.95rem);
            font-weight: 600;
            line-height: 1.3;
        }

        [data-theme="light"] .grid .btn span {
            color: var(--light-text);
        }

        /* ================================
           ENHANCED FLOATING BUTTONS
           ================================ */

        .fab-container {
            position: fixed;
            bottom: 90px;
            right: 20px;
            z-index: 99;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
        }

        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.25rem;
            cursor: pointer;
            z-index: 100;
            transition: var(--transition);
            box-shadow: var(--shadow-md);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            border: none;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-primary), var(--shadow-lg);
        }

        .fab-menu {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: var(--transition);
        }

        .fab-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .fab-option {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--card-dark);
            color: var(--text-light);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        [data-theme="light"] .fab-option {
            background: var(--light-card);
            color: var(--light-text);
            border: 1px solid var(--light-border);
        }

        .fab-option:hover {
            transform: scale(1.1);
            background: var(--primary-color);
            color: white;
        }

        .fab-option i {
            font-size: 1.1rem;
        }

        .back-to-top {
            bottom: 90px;
            left: 20px;
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(10px);
            color: var(--primary-color);
            opacity: 0;
            visibility: hidden;
            border: 1px solid rgba(244, 105, 0, 0.3);
            width: 48px;
            height: 48px;
            font-size: 1.1rem;
        }

        [data-theme="light"] .back-to-top {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(244, 105, 0, 0.3);
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            background: var(--card-light);
            transform: translateY(-3px);
            border-color: var(--primary-color);
        }

        [data-theme="light"] .back-to-top:hover {
            background: rgba(255, 255, 255, 0.95);
        }

        /* ================================
           ENHANCED LOADING SCREEN
           ================================ */

        .loader {
            position: fixed;
            inset: 0;
            background: var(--dark-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s, visibility 0.5s;
        }

        [data-theme="light"] .loader {
            background: var(--light-bg);
        }

        .loader.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loader-circle {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(244, 105, 0, 0.2);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            position: relative;
        }

        .loader-circle::after {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            border: 4px solid transparent;
            border-top-color: var(--secondary-color);
            animation: spin 1.5s linear infinite reverse;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ================================
           MODAL STYLES
           ================================ */

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            backdrop-filter: blur(5px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .modal-content-wrapper {
            background: var(--card-dark);
            border-radius: 20px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s;
            width: 100%;
        }

        .modal-overlay.visible .modal-content-wrapper {
            transform: translateY(0);
        }

        [data-theme="light"] .modal-content-wrapper {
            background: var(--light-card);
            border: 1px solid var(--light-border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        /* ================================
           NOTIFICATION STYLES
           ================================ */

        .notification {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: var(--card-dark);
            color: var(--text-light);
            padding: 0.75rem 1.25rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--primary-color);
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 280px;
            font-size: 0.9rem;
        }

        [data-theme="light"] .notification {
            background: var(--light-card);
            color: var(--light-text);
            box-shadow: var(--light-shadow-lg);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left-color: var(--success-color);
        }

        .notification.error {
            border-left-color: var(--danger-color);
        }

        .notification.info {
            border-left-color: var(--info-color);
        }

        .notification.warning {
            border-left-color: var(--warning-color);
        }

        /* ================================
           SEARCH BAR STYLES
           ================================ */

        .search-container {
            position: relative;
            margin: 1.5rem 0;
            max-width: 100%;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 2.5rem 0.75rem 1rem;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: var(--card-dark);
            color: var(--text-light);
            font-size: 0.9rem;
            transition: var(--transition);
        }

        [data-theme="light"] .search-input {
            background: var(--light-card);
            color: var(--light-text);
            border: 1px solid var(--light-border);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(244, 105, 0, 0.2);
        }

        .search-button {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary-color);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-button:hover {
            background: var(--primary-light);
        }

        /* ================================
           CHART CONTAINER STYLES
           ================================ */

        .chart-container {
            position: relative;
            height: 250px;
            margin: 15px 0;
            background: var(--card-dark);
            border-radius: var(--border-radius);
            padding: 0.75rem;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        [data-theme="light"] .chart-container {
            background: var(--light-card);
            border: 1px solid var(--light-border);
            box-shadow: var(--light-shadow-md);
        }

        /* ================================
           TABLE STYLES
           ================================ */

        .table-container {
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        [data-theme="light"] .table-container {
            border: 1px solid var(--light-border);
            box-shadow: var(--light-shadow-md);
        }

        .table {
            color: var(--text-light);
            margin-bottom: 0;
            font-size: 0.9rem;
        }

        [data-theme="light"] .table {
            color: var(--light-text);
        }

        .table thead th {
            border-bottom: 2px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
            font-size: 0.85rem;
            padding: 0.75rem 0.5rem;
        }

        .table tbody tr {
            transition: var(--transition);
        }

        .table tbody tr:hover {
            background-color: rgba(244, 105, 0, 0.1);
        }

        [data-theme="light"] .table tbody tr:hover {
            background-color: rgba(244, 105, 0, 0.05);
        }

        .table tbody td {
            padding: 0.75rem 0.5rem;
            vertical-align: middle;
        }

        /* ================================
           FORM STYLES
           ================================ */

        .form-control, .form-select {
            background: var(--card-dark);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            border-radius: var(--border-radius);
            padding: 0.6rem 0.75rem;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        [data-theme="light"] .form-control, 
        [data-theme="light"] .form-select {
            background: var(--light-card);
            border: 1px solid var(--light-border);
            color: var(--light-text);
        }

        .form-control:focus, .form-select:focus {
            background: var(--card-light);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(244, 105, 0, 0.2);
            color: var(--text-light);
        }

        [data-theme="light"] .form-control:focus, 
        [data-theme="light"] .form-select:focus {
            background: #fff;
            color: var(--light-text);
        }

        .form-label {
            color: var(--text-light);
            font-weight: 500;
            margin-bottom: 0.4rem;
            font-size: 0.9rem;
        }

        [data-theme="light"] .form-label {
            color: var(--light-text);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border: none;
            border-radius: var(--border-radius);
            padding: 0.6rem 1.25rem;
            font-weight: 600;
            color: white;
            transition: var(--transition);
            box-shadow: var(--shadow-primary);
            font-size: 0.9rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(244, 105, 0, 0.3);
        }

        .btn-outline-primary {
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            background: transparent;
            border-radius: var(--border-radius);
            padding: 0.6rem 1.25rem;
            font-weight: 600;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .btn-outline-primary:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        /* ================================
           CARD STYLES
           ================================ */

        .card {
            background: linear-gradient(135deg, var(--card-dark), var(--card-light));
            border-radius: var(--border-radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: var(--shadow-md);
            margin-bottom: 1.25rem;
            transition: var(--transition);
        }

        [data-theme="light"] .card {
            background: linear-gradient(135deg, var(--light-card), #f0f0f0);
            border: 1px solid var(--light-border);
            box-shadow: var(--light-shadow-md);
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        [data-theme="light"] .card:hover {
            box-shadow: var(--light-shadow-lg);
        }

        .card-header {
            background: transparent;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.75rem 1.25rem;
        }

        [data-theme="light"] .card-header {
            border-bottom: 1px solid var(--light-border);
        }

        .card-body {
            padding: 1.25rem;
        }

        /* ================================
           BADGE STYLES
           ================================ */

        .badge {
            border-radius: 30px;
            padding: 0.4rem 0.6rem;
            font-weight: 500;
            font-size: 0.75rem;
        }

        .badge-income {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success-color);
        }

        .badge-expense {
            background: rgba(244, 67, 54, 0.2);
            color: var(--danger-color);
        }

        /* ================================
           UTILITY STYLES
           ================================ */

        .text-primary {
            color: var(--primary-color) !important;
        }

        .text-success {
            color: var(--success-color) !important;
        }

        .text-danger {
            color: var(--danger-color) !important;
        }

        .text-warning {
            color: var(--warning-color) !important;
        }

        .text-info {
            color: var(--info-color) !important;
        }

        .bg-primary {
            background-color: var(--primary-color) !important;
        }

        .bg-success {
            background-color: var(--success-color) !important;
        }

        .bg-danger {
            background-color: var(--danger-color) !important;
        }

        .bg-warning {
            background-color: var(--warning-color) !important;
        }

        .bg-info {
            background-color: var(--info-color) !important;
        }

        /* ================================
           SCROLLBAR STYLES
           ================================ */

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--dark-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-light);
        }

        [data-theme="light"] ::-webkit-scrollbar-track {
            background: var(--light-bg);
        }

        /* ================================
           BOTTOM NAVIGATION
           ================================ */

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--bottom-nav-height);
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            z-index: 999;
            display: none;
            padding: 0.5rem 0;
        }

        [data-theme="light"] .bottom-nav {
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }

        .bottom-nav-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 100%;
            max-width: var(--container-max-width);
            margin: 0 auto;
            padding: 0 1rem;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            transition: var(--transition);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 8px;
            width: 60px;
        }

        [data-theme="light"] .bottom-nav-item {
            color: var(--light-text-muted);
        }

        .bottom-nav-item.active {
            color: var(--primary-color);
        }

        [data-theme="light"] .bottom-nav-item.active {
            color: var(--primary-color);
        }

        .bottom-nav-item i {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .bottom-nav-item span {
            font-size: 0.7rem;
            font-weight: 500;
        }

        /* ================================
           RESPONSIVE STYLES
           ================================ */

        /* Small devices (landscape phones) */
        @media (min-width: 576px) {
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }
            
            .card-balance .actions a {
                min-width: 160px;
            }
        }

        /* Medium devices (tablets) */
        @media (min-width: 768px) {
            :root {
                --section-gap: 2.5rem;
                --card-padding: 2rem;
            }
            
            .app {
                padding: 1.5rem;
            }
            
            .header {
                margin: 5.5rem 0 3rem;
            }
            
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 1.25rem;
            }
            
            .grid .btn {
                min-height: 140px;
            }
            
            .card-balance .actions {
                flex-wrap: nowrap;
            }
            
            .navbar-menu {
                display: flex !important;
            }
            
            .navbar-toggle {
                display: none !important;
            }
            
            .bottom-nav {
                display: none !important;
            }
            
            body {
                padding-bottom: 0;
            }
        }

        /* Large devices (desktops) */
        @media (min-width: 992px) {
            :root {
                --section-gap: 3rem;
                --card-padding: 2.5rem;
            }
            
            .app {
                padding: 2rem;
            }
            
            .header {
                margin: 6.5rem 0 4rem;
            }
            
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 1.5rem;
            }
            
            .grid .btn {
                padding: 1.75rem 1rem;
                min-height: 160px;
            }
        }

        /* Extra large devices */
        @media (min-width: 1200px) {
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
        }

        /* Mobile Navigation */
        @media (max-width: 767px) {
            .navbar-menu {
                position: fixed;
                top: 0;
                left: 0;
                width: 80%;
                max-width: 300px;
                height: 100vh;
                background: rgba(20, 20, 20, 0.98);
                backdrop-filter: blur(10px);
                flex-direction: column;
                padding: 5rem 1rem 2rem;
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
                z-index: 999; /* Di bawah navbar (1000) */
            }
            
            [data-theme="light"] .navbar-menu {
                background: rgba(255, 255, 255, 0.98);
            }

            /* Tampilkan menu saat aktif */
            .navbar-menu.active {
                transform: translateX(0);
            }

            /* Gaya untuk item menu di mobile */
            .navbar-menu li {
                width: 100%;
                margin-bottom: 0.5rem;
            }
            .navbar-menu li a {
                display: block;
                padding: 0.75rem 1rem;
                color: var(--text-light);
                text-decoration: none;
                border-radius: 5px;
                transition: background-color 0.2s, color 0.2s;
            }
            
            [data-theme="light"] .navbar-menu li a {
                color: var(--light-text);
            }
            
            .navbar-menu li a:hover {
                color: var(--primary-color);
                background-color: rgba(244, 105, 0, 0.1);
            }
            
            /* Gaya untuk overlay */
            .menu-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 998; /* Di bawah menu (999) */
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s, visibility 0.3s;
            }
            .menu-overlay.active {
                opacity: 1;
                visibility: visible;
            }
            
            .navbar-toggle {
                display: block !important;
            }
            
            .bottom-nav {
                display: block;
            }
            
            .fab-container {
                bottom: 90px;
            }
            
            .back-to-top {
                bottom: 90px;
            }
            
            .modal-content-wrapper {
                border-radius: 16px 16px 0 0;
                max-width: 100%;
                max-height: 85vh;
                bottom: 0;
                top: auto;
                border-radius: 20px 20px 0 0;
            }
            
            .chart-container {
                height: 200px;
            }
        }

        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .card-balance:hover,
            .grid .btn:hover,
            .fab:hover,
            .back-to-top:hover {
                transform: none;
            }
            
            .grid .btn:active {
                transform: scale(0.98);
            }
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --text-light: #ffffff;
                --text-muted: #cccccc;
            }
            
            .card-balance,
            .grid .btn {
                border: 2px solid rgba(255,255,255,0.3);
            }
        }

        /* Dark mode (already dark, but for systems) */
        @media (prefers-color-scheme: dark) {
            /* Already optimized for dark */
        }

        /* Print styles */
        @media print {
            body::before,
            .fab,
            .back-to-top,
            .loader,
            .navbar,
            .bottom-nav {
                display: none !important;
            }
            
            .card-balance,
            .grid .btn {
                box-shadow: none;
                border: 1px solid #000;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loader" id="loader">
        <div class="loader-circle"></div>
    </div>

    <!-- App Container -->
    <div class="app-container">
        <!-- Navbar -->
        <nav class="navbar" id="navbar">
            <div class="navbar-container">
                <div class="navbar-logo">
                    <i class="fas fa-wallet"></i>
                    <span>Hafilist Track</span>
                </div>
                
                <ul class="navbar-menu" id="navbarMenu">
                    <li><a href="#dashboard">Dashboard</a></li>
                    <li><a href="#transactions">Transaksi</a></li>
                    <li><a href="#budgets">Anggaran</a></li>
                    <li><a href="#goals">Tujuan</a></li>
                    <li><a href="#reports">Laporan</a></li>
                </ul>
                
                <div class="navbar-actions">
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="navbar-toggle" id="navbarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
            
            <!-- Menu Overlay for Mobile -->
            <div class="menu-overlay" id="menuOverlay"></div>
        </nav>

        <!-- Main Content -->
        <div class="app">
            <!-- Header -->
            <header class="header">
                <div class="header-badge">Aplikasi Keuangan Pribadi</div>
                <h1>Kendalikan Keuangan Anda</h1>
                <p>Pantau pengeluaran, atur anggaran, dan capai tujuan keuangan Anda dengan mudah</p>
            </header>

            <!-- Balance Card -->
            <div class="card-balance">
                <h2 id="totalBalance">Rp 0</h2>
                <div class="coins">Total Saldo</div>
                
                <div class="actions">
                    <a href="#" id="addIncomeBtn">
                        <i class="fas fa-plus-circle me-2"></i>Tambah Pemasukan
                    </a>
                    <a href="#" id="addExpenseBtn">
                        <i class="fas fa-minus-circle me-2"></i>Tambah Pengeluaran
                    </a>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="row mb-3">
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted">Pemasukan Bulan Ini</h6>
                                    <h4 class="mb-0 text-success" id="monthlyIncome">Rp 0</h4>
                                </div>
                                <div class="fs-1 text-success">
                                    <i class="fas fa-arrow-up"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted">Pengeluaran Bulan Ini</h6>
                                    <h4 class="mb-0 text-danger" id="monthlyExpense">Rp 0</h4>
                                </div>
                                <div class="fs-1 text-danger">
                                    <i class="fas fa-arrow-down"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted">Tabungan Bulan Ini</h6>
                                    <h4 class="mb-0 text-primary" id="monthlySavings">Rp 0</h4>
                                </div>
                                <div class="fs-1 text-primary">
                                    <i class="fas fa-piggy-bank"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions Grid -->
            <div class="section">
                <div class="section-header">
                    <h3><i class="fas fa-bolt"></i> Aksi Cepat</h3>
                    <a href="#" id="viewAllActions">Lihat Semua <i class="fas fa-arrow-right"></i></a>
                </div>
                
                <div class="grid">
                    <div class="btn" id="quickTransferBtn">
                        <div class="icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <span>Transfer</span>
                    </div>
                    <div class="btn" id="quickBudgetBtn">
                        <div class="icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <span>Anggaran</span>
                    </div>
                    <div class="btn" id="quickGoalBtn">
                        <div class="icon">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <span>Tujuan</span>
                    </div>
                    <div class="btn" id="quickReportBtn">
                        <div class="icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <span>Laporan</span>
                    </div>
                    <div class="btn" id="quickRecurringBtn">
                        <div class="icon">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <span>Terulang</span>
                    </div>
                    <div class="btn" id="quickDebtBtn">
                        <div class="icon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <span>Hutang</span>
                    </div>
                </div>
            </div>

            <!-- Filter Section -->
            <div class="section">
                <div class="card">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-3 mb-2">
                                <label for="filterPeriod" class="form-label">Filter Periode</label>
                                <select class="form-select" id="filterPeriod">
                                    <option value="daily">Harian</option>
                                    <option value="weekly">Mingguan</option>
                                    <option value="monthly" selected>Bulanan</option>
                                    <option value="yearly">Tahunan</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="filterMonth" class="form-label">Bulan</label>
                                <select class="form-select" id="filterMonth">
                                    <option value="0">Januari</option>
                                    <option value="1">Februari</option>
                                    <option value="2">Maret</option>
                                    <option value="3">April</option>
                                    <option value="4">Mei</option>
                                    <option value="5">Juni</option>
                                    <option value="6">Juli</option>
                                    <option value="7">Agustus</option>
                                    <option value="8">September</option>
                                    <option value="9">Oktober</option>
                                    <option value="10">November</option>
                                    <option value="11" selected>Desember</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="filterYear" class="form-label">Tahun</label>
                                <select class="form-select" id="filterYear">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-3 mb-2 d-flex align-items-end">
                                <button class="btn btn-primary w-100" id="applyFilter">
                                    <i class="fas fa-filter me-2"></i>Terapkan
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="section">
                <div class="row">
                    <div class="col-md-8 mb-3">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Grafik Pemasukan vs Pengeluaran</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="incomeExpenseChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Persentase Kategori</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="categoryChart"></canvas>
                                </div>
                                <div class="category-colors" id="categoryColors">
                                    <!-- Category colors will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Budget Progress Section -->
            <div class="section">
                <div class="section-header">
                    <h3><i class="fas fa-wallet"></i> Progress Anggaran</h3>
                    <a href="#" id="manageBudgets">Kelola <i class="fas fa-cog"></i></a>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div id="budgetProgressContainer">
                            <!-- Budget progress bars will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Goals Section -->
            <div class="section">
                <div class="section-header">
                    <h3><i class="fas fa-bullseye"></i> Tujuan Keuangan</h3>
                    <a href="#" id="addGoal">Tambah Tujuan <i class="fas fa-plus"></i></a>
                </div>
                
                <div class="row" id="goalsContainer">
                    <!-- Goals will be populated by JavaScript -->
                </div>
            </div>

            <!-- Debt Management Section -->
            <div class="section">
                <div class="section-header">
                    <h3><i class="fas fa-credit-card"></i> Hutang & Piutang</h3>
                    <a href="#" id="addDebt">Tambah <i class="fas fa-plus"></i></a>
                </div>
                
                <div class="row" id="debtsContainer">
                    <!-- Debts will be populated by JavaScript -->
                </div>
            </div>

            <!-- Enhanced Reports Section -->
            <div class="section">
                <div class="section-header">
                    <h3><i class="fas fa-chart-line"></i> Laporan Keuangan</h3>
                    <div>
                        <select class="form-select d-inline-block w-auto me-2" id="reportType">
                            <option value="trend">Trend Keuangan</option>
                            <option value="comparison">Perbandingan Bulanan</option>
                            <option value="category">Analisis Kategori</option>
                            <option value="budget">Performa Anggaran</option>
                        </select>
                        <button class="btn btn-sm btn-primary" id="generateReport">
                            <i class="fas fa-sync-alt me-1"></i>Perbarui
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="enhancedReportChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Budget Recommendations Section -->
            <div class="section">
                <div class="section-header">
                    <h3><i class="fas fa-lightbulb"></i> Rekomendasi Anggaran</h3>
                    <button class="btn btn-sm btn-outline-primary" id="refreshRecommendations">
                        <i class="fas fa-sync-alt me-1"></i>Perbarui
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div id="recommendationsContainer">
                            <!-- Recommendations will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transaction History -->
            <div class="section">
                <div class="section-header">
                    <h3><i class="fas fa-history"></i> Riwayat Transaksi</h3>
                    <div>
                        <button class="btn btn-sm btn-outline-primary me-2" id="printBtn">
                            <i class="fas fa-print me-1"></i>Cetak
                        </button>
                        <button class="btn btn-sm btn-outline-primary" id="exportBtn">
                            <i class="fas fa-file-export me-1"></i>Export
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body p-0">
                        <div class="table-container">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>Tanggal</th>
                                            <th>Deskripsi</th>
                                            <th>Kategori</th>
                                            <th>Jumlah</th>
                                            <th>Status</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="transactionTableBody">
                                        <!-- Transactions will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="text-center py-3" id="noTransactionsMessage">
                            <p class="text-muted">Belum ada transaksi. Klik "Tambah Pemasukan/Pengeluaran" untuk memulai.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation for Mobile -->
    <div class="bottom-nav">
        <div class="bottom-nav-container">
            <div class="bottom-nav-item active" data-section="dashboard">
                <i class="fas fa-home"></i>
                <span>Beranda</span>
            </div>
            <div class="bottom-nav-item" data-section="transactions">
                <i class="fas fa-exchange-alt"></i>
                <span>Transaksi</span>
            </div>
            <div class="bottom-nav-item" data-section="budgets">
                <i class="fas fa-calculator"></i>
                <span>Anggaran</span>
            </div>
            <div class="bottom-nav-item" data-section="goals">
                <i class="fas fa-bullseye"></i>
                <span>Tujuan</span>
            </div>
            <div class="bottom-nav-item" data-section="reports">
                <i class="fas fa-chart-line"></i>
                <span>Laporan</span>
            </div>
        </div>
    </div>

    <!-- Floating Action Button Container -->
    <div class="fab-container">
        <div class="fab-menu" id="fabMenu">
            <div class="fab-option" id="fabIncome" title="Tambah Pemasukan">
                <i class="fas fa-plus"></i>
            </div>
            <div class="fab-option" id="fabExpense" title="Tambah Pengeluaran">
                <i class="fas fa-minus"></i>
            </div>
            <div class="fab-option" id="fabTransfer" title="Transfer">
                <i class="fas fa-exchange-alt"></i>
            </div>
        </div>
        <div class="fab" id="fab">
            <i class="fas fa-plus"></i>
        </div>
    </div>

    <!-- Back to Top Button -->
    <div class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </div>

    <!-- Transaction Modal -->
    <div class="modal-overlay" id="transactionModal">
        <div class="modal-content-wrapper">
            <div class="modal-header">
                <h5 class="modal-title" id="transactionModalTitle">Tambah Transaksi Baru</h5>
                <button type="button" class="btn-close" id="closeTransactionModal"></button>
            </div>
            <div class="modal-body">
                <form id="transactionForm">
                    <input type="hidden" id="transactionId">
                    
                    <div class="mb-3">
                        <label for="transactionType" class="form-label">Tipe Transaksi</label>
                        <select class="form-select" id="transactionType" required>
                            <option value="income">Pemasukan</option>
                            <option value="expense">Pengeluaran</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="transactionAmount" class="form-label">Jumlah (Rp)</label>
                        <div class="input-group">
                            <span class="input-group-text">Rp</span>
                            <input type="number" class="form-control" id="transactionAmount" placeholder="0" min="0" step="100" required>
                        </div>
                        <div class="invalid-feedback">Masukkan jumlah yang valid</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="transactionDate" class="form-label">Tanggal</label>
                        <input type="date" class="form-control" id="transactionDate" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="transactionTime" class="form-label">Jam</label>
                        <input type="time" class="form-control" id="transactionTime" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="transactionCategory" class="form-label">Kategori</label>
                        <select class="form-select" id="transactionCategory" required>
                            <option value="">Pilih Kategori</option>
                            <option value="food">Makanan</option>
                            <option value="transport">Transportasi</option>
                            <option value="salary">Gaji</option>
                            <option value="shopping">Belanja</option>
                            <option value="bills">Tagihan</option>
                            <option value="entertainment">Hiburan</option>
                            <option value="health">Kesehatan</option>
                            <option value="education">Pendidikan</option>
                            <option value="other">Lainnya</option>
                            <option value="custom">+ Kategori Baru</option>
                        </select>
                    </div>
                    
                    <div class="mb-3" id="customCategoryContainer" style="display: none;">
                        <label for="customCategory" class="form-label">Nama Kategori Baru</label>
                        <input type="text" class="form-control" id="customCategory" placeholder="Masukkan nama kategori">
                    </div>
                    
                    <div class="mb-3">
                        <label for="transactionDescription" class="form-label">Deskripsi</label>
                        <textarea class="form-control" id="transactionDescription" rows="2" placeholder="Tambahkan deskripsi transaksi"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="transactionTags" class="form-label">Tag (Opsional)</label>
                        <input type="text" class="form-control" id="transactionTags" placeholder="#urgent, #bisnis, #keluarga">
                        <div class="form-text">Pisahkan tag dengan koma</div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="budgetWarning">
                            <label class="form-check-label" for="budgetWarning">
                                Beri tahu jika pengeluaran melebihi budget
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="recurringTransaction">
                            <label class="form-check-label" for="recurringTransaction">
                                Transaksi berulang
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3" id="recurringOptions" style="display: none;">
                        <label for="recurringFrequency" class="form-label">Frekuensi</label>
                        <select class="form-select" id="recurringFrequency">
                            <option value="daily">Harian</option>
                            <option value="weekly">Mingguan</option>
                            <option value="monthly" selected>Bulanan</option>
                            <option value="yearly">Tahunan</option>
                        </select>
                    </div>
                    
                    <div class="mb-3" id="recurringEndDateContainer" style="display: none;">
                        <label for="recurringEndDate" class="form-label">End Date (Optional)</label>
                        <input type="date" class="form-control" id="recurringEndDate">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelTransaction">Batal</button>
                <button type="button" class="btn btn-primary" id="saveTransaction">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Budget Modal -->
    <div class="modal-overlay" id="budgetModal">
        <div class="modal-content-wrapper">
            <div class="modal-header">
                <h5 class="modal-title" id="budgetModalTitle">Kelola Anggaran</h5>
                <button type="button" class="btn-close" id="closeBudgetModal"></button>
            </div>
            <div class="modal-body">
                <form id="budgetForm">
                    <input type="hidden" id="budgetId">
                    
                    <div class="mb-3">
                        <label for="budgetCategory" class="form-label">Kategori</label>
                        <select class="form-select" id="budgetCategory" required>
                            <option value="">Pilih Kategori</option>
                            <option value="food">Makanan</option>
                            <option value="transport">Transportasi</option>
                            <option value="shopping">Belanja</option>
                            <option value="bills">Tagihan</option>
                            <option value="entertainment">Hiburan</option>
                            <option value="health">Kesehatan</option>
                            <option value="education">Pendidikan</option>
                            <option value="other">Lainnya</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="budgetAmount" class="form-label">Jumlah Anggaran (Rp)</label>
                        <div class="input-group">
                            <span class="input-group-text">Rp</span>
                            <input type="number" class="form-control" id="budgetAmount" placeholder="0" min="0" step="100" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="budgetPeriod" class="form-label">Periode</label>
                        <select class="form-select" id="budgetPeriod">
                            <option value="monthly" selected>Bulanan</option>
                            <option value="weekly">Mingguan</option>
                            <option value="yearly">Tahunan</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="budgetNotification" class="form-label">Notifikasi</label>
                        <select class="form-select" id="budgetNotification">
                            <option value="80">80% tercapai</option>
                            <option value="90">90% tercapai</option>
                            <option value="100">100% tercapai</option>
                            <option value="none">Tidak ada</option>
                        </select>
                    </div>
                </form>
                
                <div class="mt-4">
                    <h6>Anggaran Saat Ini</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Kategori</th>
                                    <th>Anggaran</th>
                                    <th>Terpakai</th>
                                    <th>Sisa</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="budgetTableBody">
                                <!-- Budgets will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelBudget">Batal</button>
                <button type="button" class="btn btn-primary" id="saveBudget">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div class="modal-overlay" id="goalModal">
        <div class="modal-content-wrapper">
            <div class="modal-header">
                <h5 class="modal-title" id="goalModalTitle">Tambah Tujuan Keuangan</h5>
                <button type="button" class="btn-close" id="closeGoalModal"></button>
            </div>
            <div class="modal-body">
                <form id="goalForm">
                    <input type="hidden" id="goalId">
                    
                    <div class="mb-3">
                        <label for="goalName" class="form-label">Nama Tujuan</label>
                        <input type="text" class="form-control" id="goalName" placeholder="Contoh: Liburan ke Bali" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="goalTargetAmount" class="form-label">Target Jumlah (Rp)</label>
                        <div class="input-group">
                            <span class="input-group-text">Rp</span>
                            <input type="number" class="form-control" id="goalTargetAmount" placeholder="0" min="0" step="100" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="goalCurrentAmount" class="form-label">Jumlah Saat Ini (Rp)</label>
                        <div class="input-group">
                            <span class="input-group-text">Rp</span>
                            <input type="number" class="form-control" id="goalCurrentAmount" placeholder="0" min="0" step="100" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="goalTargetDate" class="form-label">Target Tanggal</label>
                        <input type="date" class="form-control" id="goalTargetDate" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="goalDescription" class="form-label">Deskripsi</label>
                        <textarea class="form-control" id="goalDescription" rows="2" placeholder="Tambahkan deskripsi tujuan"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelGoal">Batal</button>
                <button type="button" class="btn btn-primary" id="saveGoal">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Debt Modal -->
    <div class="modal-overlay" id="debtModal">
        <div class="modal-content-wrapper">
            <div class="modal-header">
                <h5 class="modal-title" id="debtModalTitle">Tambah Hutang/Piutang</h5>
                <button type="button" class="btn-close" id="closeDebtModal"></button>
            </div>
            <div class="modal-body">
                <form id="debtForm">
                    <input type="hidden" id="debtId">
                    
                    <div class="mb-3">
                        <label for="debtType" class="form-label">Tipe</label>
                        <select class="form-select" id="debtType" required>
                            <option value="debt">Hutang (Saya berutang)</option>
                            <option value="receivable">Piutang (Orang berutang ke saya)</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="debtName" class="form-label">Nama</label>
                        <input type="text" class="form-control" id="debtName" placeholder="Contoh: Hutang Bank" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="debtTotalAmount" class="form-label">Jumlah Total (Rp)</label>
                        <div class="input-group">
                            <span class="input-group-text">Rp</span>
                            <input type="number" class="form-control" id="debtTotalAmount" placeholder="0" min="0" step="100" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="debtAmountPaid" class="form-label">Jumlah Dibayar (Rp)</label>
                        <div class="input-group">
                            <span class="input-group-text">Rp</span>
                            <input type="number" class="form-control" id="debtAmountPaid" placeholder="0" min="0" step="100" value="0">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="debtDueDate" class="form-label">Jatuh Tempo</label>
                        <input type="date" class="form-control" id="debtDueDate" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="debtDescription" class="form-label">Deskripsi</label>
                        <textarea class="form-control" id="debtDescription" rows="2" placeholder="Tambahkan deskripsi"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelDebt">Batal</button>
                <button type="button" class="btn btn-primary" id="saveDebt">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content-wrapper">
            <div class="modal-header">
                <h5 class="modal-title">Pengaturan</h5>
                <button type="button" class="btn-close" id="closeSettingsModal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <h6>Pengaturan Aplikasi</h6>
                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="currencyFormat" checked>
                        <label class="form-check-label" for="currencyFormat">
                            Format Mata Uang: Rp
                        </label>
                    </div>
                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="autoBackup">
                        <label class="form-check-label" for="autoBackup">
                            Backup Otomatis
                        </label>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="autoDeleteToggle">
                        <label class="form-check-label" for="autoDeleteToggle">
                            Hapus otomatis data lebih dari 1 tahun
                        </label>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6>Manajemen Data</h6>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-warning" id="backupDataBtn">
                            <i class="fas fa-cloud-upload-alt me-2"></i>Backup Data
                        </button>
                        <button class="btn btn-outline-info" id="importDataBtn">
                            <i class="fas fa-file-import me-2"></i>Import Data
                        </button>
                        <button class="btn btn-outline-danger" id="resetDataBtn">
                            <i class="fas fa-trash-alt me-2"></i>Reset Data
                        </button>
                    </div>
                    <input type="file" id="importFileInput" style="display: none;" accept=".json,.csv">
                </div>
                
                <div class="mb-3">
                    <h6>Keyboard Shortcuts</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <tbody>
                                <tr>
                                    <td><kbd>Ctrl</kbd> + <kbd>N</kbd></td>
                                    <td>Tambah Transaksi Baru</td>
                                </tr>
                                <tr>
                                    <td><kbd>Ctrl</kbd> + <kbd>F</kbd></td>
                                    <td>Cari Transaksi</td>
                                </tr>
                                <tr>
                                    <td><kbd>Ctrl</kbd> + <kbd>E</kbd></td>
                                    <td>Export Data</td>
                                </tr>
                                <tr>
                                    <td><kbd>Ctrl</kbd> + <kbd>D</kbd></td>
                                    <td>Toggle Dark Mode</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="closeSettings">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Export Options Modal -->
    <div class="modal-overlay" id="exportOptionsModal">
        <div class="modal-content-wrapper">
            <div class="modal-header">
                <h5 class="modal-title">Export Data</h5>
                <button type="button" class="btn-close" id="closeExportModal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="exportFormat" class="form-label">Format Export</label>
                    <select class="form-select" id="exportFormat">
                        <option value="json">JSON</option>
                        <option value="csv">CSV</option>
                        <option value="pdf">PDF</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="exportPeriod" class="form-label">Periode</label>
                    <select class="form-select" id="exportPeriod">
                        <option value="all">Semua Data</option>
                        <option value="currentMonth">Bulan Ini</option>
                        <option value="lastMonth">Bulan Lalu</option>
                        <option value="currentYear">Tahun Ini</option>
                        <option value="custom">Kustom</option>
                    </select>
                </div>
                
                <div class="mb-3" id="customExportDates" style="display: none;">
                    <div class="row">
                        <div class="col-md-6">
                            <label for="exportStartDate" class="form-label">Dari Tanggal</label>
                            <input type="date" class="form-control" id="exportStartDate">
                        </div>
                        <div class="col-md-6">
                            <label for="exportEndDate" class="form-label">Sampai Tanggal</label>
                            <input type="date" class="form-control" id="exportEndDate">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelExport">Batal</button>
                <button type="button" class="btn btn-primary" id="confirmExport">Export</button>
            </div>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div class="modal-overlay" id="resetConfirmationModal">
        <div class="modal-content-wrapper">
            <div class="modal-header">
                <h5 class="modal-title">Konfirmasi Reset Data</h5>
                <button type="button" class="btn-close" id="closeResetModal"></button>
            </div>
            <div class="modal-body">
                <p>Anda yakin ingin mereset semua data? Tindakan ini tidak dapat dibatalkan.</p>
                <div class="mb-3">
                    <label for="resetPassword" class="form-label">Masukkan password untuk konfirmasi</label>
                    <input type="password" class="form-control" id="resetPassword" placeholder="Password">
                    <div class="invalid-feedback">Password salah</div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelReset">Batal</button>
                <button type="button" class="btn btn-danger" id="confirmReset">Reset Data</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Global variables
        let transactions = [];
        let budgets = [];
        let goals = [];
        let debts = [];
        let incomeExpenseChart = null;
        let categoryChart = null;
        let enhancedReportChart = null;
        let currentFilter = {
            period: 'monthly',
            month: new Date().getMonth(),
            year: new Date().getFullYear()
        };

        // Category colors
        const categoryColors = {
            food: '#FF6384',
            transport: '#36A2EB',
            salary: '#4BC0C0',
            shopping: '#FF9F40',
            bills: '#9966FF',
            entertainment: '#FF6384',
            health: '#C9CBCF',
            education: '#4BC0C0',
            other: '#FF9F40'
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Hide loader after page loads
            setTimeout(() => {
                document.getElementById('loader').classList.add('hidden');
            }, 800);
            
            // Load data from localStorage
            loadDataFromStorage();
            
            // Set current date and time in form
            const now = new Date();
            document.getElementById('transactionDate').value = now.toISOString().split('T')[0];
            document.getElementById('transactionTime').value = now.toTimeString().slice(0, 5);
            
            // Populate year filter
            populateYearFilter();
            
            // Initialize charts
            initializeCharts();
            
            // Update dashboard
            updateDashboard();
            
            // Setup event listeners
            setupEventListeners();
            
            // Check if auto-delete is enabled
            checkAutoDelete();
            
            // Setup back to top button
            setupBackToTop();
            
            // Setup navbar scroll effect
            setupNavbarScroll();
            
            // Setup bottom navigation
            setupBottomNavigation();
            
            // Setup FAB menu
            setupFabMenu();

            // Setup recurring transactions
            setupRecurringTransactions();
            
            // Add recurring transaction options to form
            addRecurringTransactionOptions();
            
            // Add debt section to the UI
            addDebtSection();
            
            // Add enhanced reports section
            addEnhancedReports();
            
            // Add budget recommendations section
            addBudgetRecommendations();
        });

        // Load data from localStorage
        function loadDataFromStorage() {
            const storedTransactions = localStorage.getItem('financeTransactions');
            if (storedTransactions) {
                transactions = JSON.parse(storedTransactions);
            }
            
            const storedBudgets = localStorage.getItem('financeBudgets');
            if (storedBudgets) {
                budgets = JSON.parse(storedBudgets);
            }
            
            const storedGoals = localStorage.getItem('financeGoals');
            if (storedGoals) {
                goals = JSON.parse(storedGoals);
            }
            
            const storedDebts = localStorage.getItem('financeDebts');
            if (storedDebts) {
                debts = JSON.parse(storedDebts);
            }
            
            const storedSettings = localStorage.getItem('financeSettings');
            if (storedSettings) {
                const settings = JSON.parse(storedSettings);
                
                // Apply theme
                if (settings.theme === 'light') {
                    document.documentElement.setAttribute('data-theme', 'light');
                    document.querySelector('#themeToggle i').classList.replace('fa-moon', 'fa-sun');
                }
                
                // Apply other settings
                if (settings.autoDelete) {
                    document.getElementById('autoDeleteToggle').checked = true;
                }
                
                if (settings.autoBackup) {
                    document.getElementById('autoBackup').checked = true;
                }
                
                if (settings.currencyFormat === false) {
                    document.getElementById('currencyFormat').checked = false;
                }
            }
        }

        // Save data to localStorage
        function saveDataToStorage() {
            localStorage.setItem('financeTransactions', JSON.stringify(transactions));
            localStorage.setItem('financeBudgets', JSON.stringify(budgets));
            localStorage.setItem('financeGoals', JSON.stringify(goals));
            localStorage.setItem('financeDebts', JSON.stringify(debts));
            
            const settings = {
                theme: document.documentElement.getAttribute('data-theme') || 'dark',
                autoDelete: document.getElementById('autoDeleteToggle').checked,
                autoBackup: document.getElementById('autoBackup').checked,
                currencyFormat: document.getElementById('currencyFormat').checked
            };
            localStorage.setItem('financeSettings', JSON.stringify(settings));
        }
        
        // Populate year filter
        function populateYearFilter() {
            const yearSelect = document.getElementById('filterYear');
            const currentYear = new Date().getFullYear();
            
            // Add current year and 5 years before
            for (let i = currentYear - 5; i <= currentYear; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                if (i === currentYear) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            }
        }
        
        // Initialize charts
        function initializeCharts() {
            // Income vs Expense Chart
            const incomeExpenseCtx = document.getElementById('incomeExpenseChart').getContext('2d');
            incomeExpenseChart = new Chart(incomeExpenseCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Pemasukan',
                            data: [],
                            backgroundColor: 'rgba(76, 175, 80, 0.7)',
                            borderColor: 'rgba(76, 175, 80, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Pengeluaran',
                            data: [],
                            backgroundColor: 'rgba(244, 67, 54, 0.7)',
                            borderColor: 'rgba(244, 67, 54, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Rp ' + value.toLocaleString('id-ID');
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': Rp ' + context.raw.toLocaleString('id-ID');
                                }
                            }
                        }
                    }
                }
            });
            
            // Category Chart
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            categoryChart = new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = 'Rp ' + context.raw.toLocaleString('id-ID');
                                    const percentage = Math.round((context.raw / context.dataset.data.reduce((a, b) => a + b, 0)) * 100);
                                    return label + ': ' + value + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update dashboard
        function updateDashboard() {
            // Calculate summary
            let totalBalance = 0;
            let monthlyIncome = 0;
            let monthlyExpense = 0;
            
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();
            
            transactions.forEach(transaction => {
                const transactionDate = new Date(transaction.date);
                
                if (transaction.type === 'income') {
                    totalBalance += transaction.amount;
                    
                    if (transactionDate.getMonth() === currentMonth && transactionDate.getFullYear() === currentYear) {
                        monthlyIncome += transaction.amount;
                    }
                } else {
                    totalBalance -= transaction.amount;
                    
                    if (transactionDate.getMonth() === currentMonth && transactionDate.getFullYear() === currentYear) {
                        monthlyExpense += transaction.amount;
                    }
                }
            });
            
            const monthlySavings = monthlyIncome - monthlyExpense;
            
            // Update summary cards
            document.getElementById('totalBalance').textContent = 'Rp ' + totalBalance.toLocaleString('id-ID');
            document.getElementById('monthlyIncome').textContent = 'Rp ' + monthlyIncome.toLocaleString('id-ID');
            document.getElementById('monthlyExpense').textContent = 'Rp ' + monthlyExpense.toLocaleString('id-ID');
            document.getElementById('monthlySavings').textContent = 'Rp ' + monthlySavings.toLocaleString('id-ID');
            
            // Update charts based on current filter
            updateCharts();
            
            // Update transaction table
            updateTransactionTable();
            
            // Update budget progress
            updateBudgetProgress();
            
            // Update goals
            updateGoals();
            
            // Update debts
            updateDebts();
            
            // Check budget warning
            if (document.getElementById('budgetWarning').checked && monthlyExpense > monthlyIncome) {
                showNotification('Peringatan: Pengeluaran bulan ini melebihi pemasukan!', 'warning');
            }
        }
        
        // Update charts based on filter
        function updateCharts() {
            // Filter transactions based on current filter
            let filteredTransactions = [...transactions];
            
            if (currentFilter.period === 'daily') {
                const today = new Date();
                filteredTransactions = transactions.filter(transaction => {
                    const transactionDate = new Date(transaction.date);
                    return transactionDate.getDate() === today.getDate() && 
                           transactionDate.getMonth() === today.getMonth() && 
                           transactionDate.getFullYear() === today.getFullYear();
                });
            } else if (currentFilter.period === 'weekly') {
                const today = new Date();
                const weekAgo = new Date(today);
                weekAgo.setDate(weekAgo.getDate() - 7);
                
                filteredTransactions = transactions.filter(transaction => {
                    const transactionDate = new Date(transaction.date);
                    return transactionDate >= weekAgo && transactionDate <= today;
                });
            } else if (currentFilter.period === 'monthly') {
                filteredTransactions = transactions.filter(transaction => {
                    const transactionDate = new Date(transaction.date);
                    return transactionDate.getMonth() === currentFilter.month && 
                           transactionDate.getFullYear() === currentFilter.year;
                });
            } else if (currentFilter.period === 'yearly') {
                filteredTransactions = transactions.filter(transaction => {
                    const transactionDate = new Date(transaction.date);
                    return transactionDate.getFullYear() === currentFilter.year;
                });
            }
            
            // Update income vs expense chart
            if (currentFilter.period === 'daily') {
                // For daily filter, show hourly data
                const hours = Array.from({length: 24}, (_, i) => i);
                const incomeByHour = new Array(24).fill(0);
                const expenseByHour = new Array(24).fill(0);
                
                filteredTransactions.forEach(transaction => {
                    const hour = new Date(transaction.date + ' ' + transaction.time).getHours();
                    if (transaction.type === 'income') {
                        incomeByHour[hour] += transaction.amount;
                    } else {
                        expenseByHour[hour] += transaction.amount;
                    }
                });
                
                incomeExpenseChart.data.labels = hours.map(h => h + ':00');
                incomeExpenseChart.data.datasets[0].data = incomeByHour;
                incomeExpenseChart.data.datasets[1].data = expenseByHour;
            } else if (currentFilter.period === 'weekly') {
                // For weekly filter, show daily data
                const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
                const incomeByDay = new Array(7).fill(0);
                const expenseByDay = new Array(7).fill(0);
                
                filteredTransactions.forEach(transaction => {
                    const day = new Date(transaction.date).getDay();
                    if (transaction.type === 'income') {
                        incomeByDay[day] += transaction.amount;
                    } else {
                        expenseByDay[day] += transaction.amount;
                    }
                });
                
                incomeExpenseChart.data.labels = days;
                incomeExpenseChart.data.datasets[0].data = incomeByDay;
                incomeExpenseChart.data.datasets[1].data = expenseByDay;
            } else if (currentFilter.period === 'monthly') {
                // For monthly filter, show daily data
                const daysInMonth = new Date(currentFilter.year, currentFilter.month + 1, 0).getDate();
                const days = Array.from({length: daysInMonth}, (_, i) => i + 1);
                const incomeByDay = new Array(daysInMonth).fill(0);
                const expenseByDay = new Array(daysInMonth).fill(0);
                
                filteredTransactions.forEach(transaction => {
                    const day = new Date(transaction.date).getDate() - 1;
                    if (transaction.type === 'income') {
                        incomeByDay[day] += transaction.amount;
                    } else {
                        expenseByDay[day] += transaction.amount;
                    }
                });
                
                incomeExpenseChart.data.labels = days;
                incomeExpenseChart.data.datasets[0].data = incomeByDay;
                incomeExpenseChart.data.datasets[1].data = expenseByDay;
            } else if (currentFilter.period === 'yearly') {
                // For yearly filter, show monthly data
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
                const incomeByMonth = new Array(12).fill(0);
                const expenseByMonth = new Array(12).fill(0);
                
                filteredTransactions.forEach(transaction => {
                    const month = new Date(transaction.date).getMonth();
                    if (transaction.type === 'income') {
                        incomeByMonth[month] += transaction.amount;
                    } else {
                        expenseByMonth[month] += transaction.amount;
                    }
                });
                
                incomeExpenseChart.data.labels = months;
                incomeExpenseChart.data.datasets[0].data = incomeByMonth;
                incomeExpenseChart.data.datasets[1].data = expenseByMonth;
            }
            
            incomeExpenseChart.update();
            
            // Update category chart (only for expenses)
            const expenses = filteredTransactions.filter(t => t.type === 'expense');
            const categoryTotals = {};
            
            expenses.forEach(transaction => {
                if (!categoryTotals[transaction.category]) {
                    categoryTotals[transaction.category] = 0;
                }
                categoryTotals[transaction.category] += transaction.amount;
            });
            
            const categoryLabels = Object.keys(categoryTotals);
            const categoryData = Object.values(categoryTotals);
            const categoryBackgroundColors = categoryLabels.map(category => {
                return categoryColors[category] || '#999999';
            });
            
            categoryChart.data.labels = categoryLabels;
            categoryChart.data.datasets[0].data = categoryData;
            categoryChart.data.datasets[0].backgroundColor = categoryBackgroundColors;
            categoryChart.update();
            
            // Update category colors legend
            const categoryColorsContainer = document.getElementById('categoryColors');
            categoryColorsContainer.innerHTML = '';
            
            categoryLabels.forEach((category, index) => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-color-item d-flex align-items-center mb-2';
                
                const colorDot = document.createElement('div');
                colorDot.className = 'color-dot me-2';
                colorDot.style.width = '12px';
                colorDot.style.height = '12px';
                colorDot.style.borderRadius = '50%';
                colorDot.style.backgroundColor = categoryBackgroundColors[index];
                
                const categoryName = document.createElement('span');
                categoryName.textContent = getCategoryName(category);
                
                categoryItem.appendChild(colorDot);
                categoryItem.appendChild(categoryName);
                categoryColorsContainer.appendChild(categoryItem);
            });
        }
        
        // Update transaction table
        function updateTransactionTable() {
            const tableBody = document.getElementById('transactionTableBody');
            const noTransactionsMessage = document.getElementById('noTransactionsMessage');
            
            // Clear table
            tableBody.innerHTML = '';
            
            // Filter transactions based on current filter
            let filteredTransactions = [...transactions];
            
            if (currentFilter.period === 'daily') {
                const today = new Date();
                filteredTransactions = filteredTransactions.filter(transaction => {
                    const transactionDate = new Date(transaction.date);
                    return transactionDate.getDate() === today.getDate() && 
                           transactionDate.getMonth() === today.getMonth() && 
                           transactionDate.getFullYear() === today.getFullYear();
                });
            } else if (currentFilter.period === 'weekly') {
                const today = new Date();
                const weekAgo = new Date(today);
                weekAgo.setDate(weekAgo.getDate() - 7);
                
                filteredTransactions = filteredTransactions.filter(transaction => {
                    const transactionDate = new Date(transaction.date);
                    return transactionDate >= weekAgo && transactionDate <= today;
                });
            } else if (currentFilter.period === 'monthly') {
                filteredTransactions = filteredTransactions.filter(transaction => {
                    const transactionDate = new Date(transaction.date);
                    return transactionDate.getMonth() === currentFilter.month && 
                           transactionDate.getFullYear() === currentFilter.year;
                });
            } else if (currentFilter.period === 'yearly') {
                filteredTransactions = filteredTransactions.filter(transaction => {
                    const transactionDate = new Date(transaction.date);
                    return transactionDate.getFullYear() === currentFilter.year;
                });
            }
            
            // Sort transactions by date and time (newest first)
            filteredTransactions.sort((a, b) => {
                const dateA = new Date(a.date + ' ' + a.time);
                const dateB = new Date(b.date + ' ' + b.time);
                return dateB - dateA;
            });
            
            // Show/hide no transactions message
            if (filteredTransactions.length === 0) {
                noTransactionsMessage.style.display = 'block';
                tableBody.parentElement.parentElement.style.display = 'none';
            } else {
                noTransactionsMessage.style.display = 'none';
                tableBody.parentElement.parentElement.style.display = 'table';
                
                // Add transactions to table (limit to 10 for display)
                const displayTransactions = filteredTransactions.slice(0, 10);
                
                displayTransactions.forEach(transaction => {
                    const row = document.createElement('tr');
                    row.className = 'transaction-item';
                    
                    // Format date
                    const date = new Date(transaction.date);
                    const formattedDate = date.toLocaleDateString('id-ID', { 
                        day: 'numeric', 
                        month: 'short', 
                        year: 'numeric' 
                    });
                    
                    // Create row HTML
                    row.innerHTML = `
                        <td>${formattedDate}</td>
                        <td>${transaction.description}</td>
                        <td>
                            <span class="badge" style="background-color: ${categoryColors[transaction.category] || '#999999'}20; color: ${categoryColors[transaction.category] || '#999999'}">
                                ${getCategoryName(transaction.category)}
                            </span>
                        </td>
                        <td class="${transaction.type === 'income' ? 'text-success' : 'text-danger'}">
                            ${transaction.type === 'income' ? '+' : '-'}Rp ${transaction.amount.toLocaleString('id-ID')}
                        </td>
                        <td>
                            <span class="badge ${transaction.type === 'income' ? 'badge-income' : 'badge-expense'}">
                                ${transaction.type === 'income' ? 'Pemasukan' : 'Pengeluaran'}
                            </span>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary edit-btn" data-id="${transaction.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger delete-btn" data-id="${transaction.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners to edit and delete buttons
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const transactionId = this.getAttribute('data-id');
                        editTransaction(transactionId);
                    });
                });
                
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const transactionId = this.getAttribute('data-id');
                        deleteTransaction(transactionId);
                    });
                });
            }
        }
        
        // Update budget progress
        function updateBudgetProgress() {
            const budgetProgressContainer = document.getElementById('budgetProgressContainer');
            budgetProgressContainer.innerHTML = '';
            
            if (budgets.length === 0) {
                budgetProgressContainer.innerHTML = '<p class="text-center text-muted">Belum ada anggaran. Klik "Kelola" untuk menambahkan anggaran.</p>';
                return;
            }
            
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();
            
            // Calculate spent amounts for each budget
            const budgetProgress = budgets.map(budget => {
                let spent = 0;
                
                transactions.forEach(transaction => {
                    if (transaction.type === 'expense' && transaction.category === budget.category) {
                        const transactionDate = new Date(transaction.date);
                        
                        if (budget.period === 'monthly' && 
                            transactionDate.getMonth() === currentMonth && 
                            transactionDate.getFullYear() === currentYear) {
                            spent += transaction.amount;
                        } else if (budget.period === 'yearly' && 
                                  transactionDate.getFullYear() === currentYear) {
                            spent += transaction.amount;
                        }
                    }
                });
                
                const remaining = budget.amount - spent;
                const percentage = Math.min(100, (spent / budget.amount) * 100);
                
                return {
                    ...budget,
                    spent,
                    remaining,
                    percentage
                };
            });
            
            // Create progress bars
            budgetProgress.forEach(budget => {
                const progressItem = document.createElement('div');
                progressItem.className = 'mb-3';
                
                let progressColor = 'success';
                if (budget.percentage > 80) progressColor = 'warning';
                if (budget.percentage > 95) progressColor = 'danger';
                
                progressItem.innerHTML = `
                    <div class="d-flex justify-content-between mb-1">
                        <span>${getCategoryName(budget.category)}</span>
                        <span>Rp ${budget.spent.toLocaleString('id-ID')} / Rp ${budget.amount.toLocaleString('id-ID')}</span>
                    </div>
                    <div class="progress" style="height: 10px;">
                        <div class="progress-bar bg-${progressColor}" role="progressbar" 
                             style="width: ${budget.percentage}%" 
                             aria-valuenow="${budget.percentage}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between mt-1">
                        <small class="text-muted">${budget.percentage.toFixed(1)}% terpakai</small>
                        <small class="text-${budget.remaining >= 0 ? 'success' : 'danger'}">
                            ${budget.remaining >= 0 ? 'Sisa' : 'Melebihi'}: Rp ${Math.abs(budget.remaining).toLocaleString('id-ID')}
                        </small>
                    </div>
                `;
                
                budgetProgressContainer.appendChild(progressItem);
                
                // Check if budget notification should be shown
                if (budget.notification !== 'none' && budget.percentage >= parseInt(budget.notification)) {
                    showNotification(`Anggaran ${getCategoryName(budget.category)} telah mencapai ${budget.percentage.toFixed(1)}%`, 'warning');
                }
            });
        }
        
        // Update goals
        function updateGoals() {
            const goalsContainer = document.getElementById('goalsContainer');
            goalsContainer.innerHTML = '';
            
            if (goals.length === 0) {
                goalsContainer.innerHTML = '<div class="col-12"><div class="card"><div class="card-body text-center"><p class="text-muted">Belum ada tujuan keuangan. Klik "Tambah Tujuan" untuk membuat tujuan baru.</p></div></div></div>';
                return;
            }
            
            goals.forEach(goal => {
                const progress = Math.min(100, (goal.currentAmount / goal.targetAmount) * 100);
                const daysLeft = Math.ceil((new Date(goal.targetDate) - new Date()) / (1000 * 60 * 60 * 24));
                
                const goalCard = document.createElement('div');
                goalCard.className = 'col-md-4 mb-3';
                
                let progressColor = 'primary';
                if (progress > 75) progressColor = 'success';
                if (daysLeft < 30 && progress < 100) progressColor = 'warning';
                if (daysLeft < 7 && progress < 100) progressColor = 'danger';
                
                goalCard.innerHTML = `
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title">${goal.name}</h5>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item edit-goal-btn" data-id="${goal.id}">Edit</a></li>
                                        <li><a class="dropdown-item delete-goal-btn" data-id="${goal.id}">Hapus</a></li>
                                        <li><a class="dropdown-item add-to-goal-btn" data-id="${goal.id}">Tambahkan Dana</a></li>
                                    </ul>
                                </div>
                            </div>
                            <p class="card-text text-muted">${goal.description}</p>
                            
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Progress</span>
                                    <span>${progress.toFixed(1)}%</span>
                                </div>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-${progressColor}" role="progressbar" 
                                         style="width: ${progress}%" 
                                         aria-valuenow="${progress}" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                            
                            <div class="row text-center">
                                <div class="col-6">
                                    <small class="text-muted d-block">Target</small>
                                    <span>Rp ${goal.targetAmount.toLocaleString('id-ID')}</span>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted d-block">Terkumpul</small>
                                    <span>Rp ${goal.currentAmount.toLocaleString('id-ID')}</span>
                                </div>
                            </div>
                            
                            <div class="mt-3 text-center">
                                <small class="text-muted">
                                    ${daysLeft > 0 ? `${daysLeft} hari tersisa` : 'Target tanggal terlewati'}
                                </small>
                            </div>
                        </div>
                    </div>
                `;
                
                goalsContainer.appendChild(goalCard);
            });
            
            // Add event listeners to goal action buttons
            document.querySelectorAll('.edit-goal-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const goalId = this.getAttribute('data-id');
                    editGoal(goalId);
                });
            });
            
            document.querySelectorAll('.delete-goal-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const goalId = this.getAttribute('data-id');
                    deleteGoal(goalId);
                });
            });
            
            document.querySelectorAll('.add-to-goal-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const goalId = this.getAttribute('data-id');
                    addToGoal(goalId);
                });
            });
        }
        
        // Update debts
        function updateDebts() {
            const debtsContainer = document.getElementById('debtsContainer');
            debtsContainer.innerHTML = '';
            
            if (debts.length === 0) {
                debtsContainer.innerHTML = '<div class="col-12"><div class="card"><div class="card-body text-center"><p class="text-muted">Belum ada data hutang/piutang. Klik "Tambah" untuk menambahkan.</p></div></div></div>';
                return;
            }
            
            debts.forEach(debt => {
                const debtCard = document.createElement('div');
                debtCard.className = 'col-md-4 mb-3';
                
                const progress = Math.min(100, (debt.amountPaid / debt.totalAmount) * 100);
                const remaining = debt.totalAmount - debt.amountPaid;
                
                debtCard.innerHTML = `
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title">${debt.name}</h5>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item edit-debt-btn" data-id="${debt.id}">Edit</a></li>
                                        <li><a class="dropdown-item delete-debt-btn" data-id="${debt.id}">Hapus</a></li>
                                        <li><a class="dropdown-item pay-debt-btn" data-id="${debt.id}">Bayar</a></li>
                                    </ul>
                                </div>
                            </div>
                            <p class="card-text text-muted">${debt.description}</p>
                            
                            <div class="mb-2">
                                <span class="badge ${debt.type === 'debt' ? 'bg-danger' : 'bg-success'}">
                                    ${debt.type === 'debt' ? 'Hutang' : 'Piutang'}
                                </span>
                            </div>
                            
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Progress</span>
                                    <span>${progress.toFixed(1)}%</span>
                                </div>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-${progress === 100 ? 'success' : 'primary'}" role="progressbar" 
                                         style="width: ${progress}%" 
                                         aria-valuenow="${progress}" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                            
                            <div class="row text-center">
                                <div class="col-6">
                                    <small class="text-muted d-block">Total</small>
                                    <span>Rp ${debt.totalAmount.toLocaleString('id-ID')}</span>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted d-block">Sisa</small>
                                    <span>Rp ${remaining.toLocaleString('id-ID')}</span>
                                </div>
                            </div>
                            
                            <div class="mt-3 text-center">
                                <small class="text-muted">
                                    Jatuh tempo: ${new Date(debt.dueDate).toLocaleDateString('id-ID')}
                                </small>
                            </div>
                        </div>
                    </div>
                `;
                
                debtsContainer.appendChild(debtCard);
            });
            
            // Add event listeners
            document.querySelectorAll('.edit-debt-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const debtId = this.getAttribute('data-id');
                    editDebt(debtId);
                });
            });
            
            document.querySelectorAll('.delete-debt-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const debtId = this.getAttribute('data-id');
                    deleteDebt(debtId);
                });
            });
            
            document.querySelectorAll('.pay-debt-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const debtId = this.getAttribute('data-id');
                    payDebt(debtId);
                });
            });
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', function() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                
                const icon = this.querySelector('i');
                if (newTheme === 'dark') {
                    icon.classList.replace('fa-sun', 'fa-moon');
                } else {
                    icon.classList.replace('fa-moon', 'fa-sun');
                }
                
                saveDataToStorage();
            });
            
            // Mobile menu toggle
            document.getElementById('navbarToggle').addEventListener('click', function() {
                const navbarMenu = document.getElementById('navbarMenu');
                const menuOverlay = document.getElementById('menuOverlay');
                
                navbarMenu.classList.toggle('active');
                menuOverlay.classList.toggle('active');
            });
            
            // Close mobile menu when clicking on overlay
            document.getElementById('menuOverlay').addEventListener('click', function() {
                const navbarMenu = document.getElementById('navbarMenu');
                const menuOverlay = document.getElementById('menuOverlay');
                
                navbarMenu.classList.remove('active');
                menuOverlay.classList.remove('active');
            });
            
            // Add income button
            document.getElementById('addIncomeBtn').addEventListener('click', function(e) {
                e.preventDefault();
                openTransactionModal('income');
            });
            
            // Add expense button
            document.getElementById('addExpenseBtn').addEventListener('click', function(e) {
                e.preventDefault();
                openTransactionModal('expense');
            });
            
            // Quick action buttons
            document.getElementById('quickTransferBtn').addEventListener('click', function() {
                showNotification('Fitur transfer akan segera tersedia', 'info');
            });
            
            document.getElementById('quickBudgetBtn').addEventListener('click', function() {
                openBudgetModal();
            });
            
            document.getElementById('quickGoalBtn').addEventListener('click', function() {
                openGoalModal();
            });
            
            document.getElementById('quickReportBtn').addEventListener('click', function() {
                showNotification('Laporan keuangan sudah tersedia di bagian bawah', 'info');
            });
            
            document.getElementById('quickRecurringBtn').addEventListener('click', function() {
                showNotification('Transaksi berulang dapat diatur saat menambah transaksi baru', 'info');
            });
            
            document.getElementById('quickDebtBtn').addEventListener('click', function() {
                showNotification('Manajemen hutang/piutang sudah tersedia di bagian bawah', 'info');
            });
            
            // Transaction form
            document.getElementById('transactionCategory').addEventListener('change', function() {
                const customCategoryContainer = document.getElementById('customCategoryContainer');
                
                if (this.value === 'custom') {
                    customCategoryContainer.style.display = 'block';
                    document.getElementById('customCategory').required = true;
                } else {
                    customCategoryContainer.style.display = 'none';
                    document.getElementById('customCategory').required = false;
                }
            });
            
            // Recurring transaction checkbox
            document.getElementById('recurringTransaction').addEventListener('change', function() {
                const recurringOptions = document.getElementById('recurringOptions');
                const recurringEndDateContainer = document.getElementById('recurringEndDateContainer');
                
                if (this.checked) {
                    recurringOptions.style.display = 'block';
                    recurringEndDateContainer.style.display = 'block';
                } else {
                    recurringOptions.style.display = 'none';
                    recurringEndDateContainer.style.display = 'none';
                }
            });
            
            // Save transaction
            document.getElementById('saveTransaction').addEventListener('click', function() {
                if (validateTransactionForm()) {
                    saveTransaction();
                }
            });
            
            // Cancel transaction
            document.getElementById('cancelTransaction').addEventListener('click', function() {
                closeTransactionModal();
            });
            
            // Close transaction modal
            document.getElementById('closeTransactionModal').addEventListener('click', function() {
                closeTransactionModal();
            });
            
            // Apply filter
            document.getElementById('applyFilter').addEventListener('click', function() {
                currentFilter.period = document.getElementById('filterPeriod').value;
                currentFilter.month = parseInt(document.getElementById('filterMonth').value);
                currentFilter.year = parseInt(document.getElementById('filterYear').value);
                
                updateDashboard();
                showNotification('Filter diterapkan', 'success');
            });
            
            // Print button
            document.getElementById('printBtn').addEventListener('click', function() {
                window.print();
            });
            
            // Export button
            document.getElementById('exportBtn').addEventListener('click', function() {
                openExportModal();
            });
            
            // Export period change
            document.getElementById('exportPeriod').addEventListener('change', function() {
                const customExportDates = document.getElementById('customExportDates');
                
                if (this.value === 'custom') {
                    customExportDates.style.display = 'block';
                } else {
                    customExportDates.style.display = 'none';
                }
            });
            
            // Confirm export
            document.getElementById('confirmExport').addEventListener('click', function() {
                const format = document.getElementById('exportFormat').value;
                const period = document.getElementById('exportPeriod').value;
                
                let startDate, endDate;
                
                if (period === 'currentMonth') {
                    const now = new Date();
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                } else if (period === 'lastMonth') {
                    const now = new Date();
                    startDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                    endDate = new Date(now.getFullYear(), now.getMonth(), 0);
                } else if (period === 'currentYear') {
                    const now = new Date();
                    startDate = new Date(now.getFullYear(), 0, 1);
                    endDate = new Date(now.getFullYear(), 11, 31);
                } else if (period === 'custom') {
                    startDate = new Date(document.getElementById('exportStartDate').value);
                    endDate = new Date(document.getElementById('exportEndDate').value);
                }
                
                exportData(format, startDate, endDate);
                
                closeExportModal();
            });
            
            // Cancel export
            document.getElementById('cancelExport').addEventListener('click', function() {
                closeExportModal();
            });
            
            // Close export modal
            document.getElementById('closeExportModal').addEventListener('click', function() {
                closeExportModal();
            });
            
            // Import data
            document.getElementById('importDataBtn').addEventListener('click', function() {
                document.getElementById('importFileInput').click();
            });
            
            document.getElementById('importFileInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    importData(file);
                }
            });
            
            // Reset data
            document.getElementById('resetDataBtn').addEventListener('click', function() {
                openResetModal();
            });
            
            // Confirm reset
            document.getElementById('confirmReset').addEventListener('click', function() {
                const password = document.getElementById('resetPassword').value;
                
                // Simple password check (in a real app, use proper authentication)
                if (password === 'reset123') {
                    transactions = [];
                    budgets = [];
                    goals = [];
                    debts = [];
                    
                    saveDataToStorage();
                    updateDashboard();
                    
                    closeResetModal();
                    
                    showNotification('Data berhasil direset', 'success');
                } else {
                    document.getElementById('resetPassword').classList.add('is-invalid');
                }
            });
            
            // Cancel reset
            document.getElementById('cancelReset').addEventListener('click', function() {
                closeResetModal();
            });
            
            // Close reset modal
            document.getElementById('closeResetModal').addEventListener('click', function() {
                closeResetModal();
            });
            
            // Backup data
            document.getElementById('backupDataBtn').addEventListener('click', function() {
                saveDataToStorage();
                showNotification('Data berhasil di-backup', 'success');
            });
            
            // Auto delete toggle
            document.getElementById('autoDeleteToggle').addEventListener('change', function() {
                saveDataToStorage();
                
                if (this.checked) {
                    showNotification('Penghapusan otomatis diaktifkan', 'info');
                } else {
                    showNotification('Penghapusan otomatis dinonaktifkan', 'info');
                }
            });
            
            // Budget management
            document.getElementById('manageBudgets').addEventListener('click', function(e) {
                e.preventDefault();
                openBudgetModal();
            });
            
            // Save budget
            document.getElementById('saveBudget').addEventListener('click', function() {
                if (validateBudgetForm()) {
                    saveBudget();
                }
            });
            
            // Cancel budget
            document.getElementById('cancelBudget').addEventListener('click', function() {
                closeBudgetModal();
            });
            
            // Close budget modal
            document.getElementById('closeBudgetModal').addEventListener('click', function() {
                closeBudgetModal();
            });
            
            // Add goal
            document.getElementById('addGoal').addEventListener('click', function(e) {
                e.preventDefault();
                openGoalModal();
            });
            
            // Save goal
            document.getElementById('saveGoal').addEventListener('click', function() {
                if (validateGoalForm()) {
                    saveGoal();
                }
            });
            
            // Cancel goal
            document.getElementById('cancelGoal').addEventListener('click', function() {
                closeGoalModal();
            });
            
            // Close goal modal
            document.getElementById('closeGoalModal').addEventListener('click', function() {
                closeGoalModal();
            });
            
            // Add debt
            document.getElementById('addDebt').addEventListener('click', function(e) {
                e.preventDefault();
                openDebtModal();
            });
            
            // Save debt
            document.getElementById('saveDebt').addEventListener('click', function() {
                if (validateDebtForm()) {
                    saveDebt();
                }
            });
            
            // Cancel debt
            document.getElementById('cancelDebt').addEventListener('click', function() {
                closeDebtModal();
            });
            
            // Close debt modal
            document.getElementById('closeDebtModal').addEventListener('click', function() {
                closeDebtModal();
            });
            
            // Settings
            document.getElementById('closeSettings').addEventListener('click', function() {
                closeSettingsModal();
            });
            
            document.getElementById('closeSettingsModal').addEventListener('click', function() {
                closeSettingsModal();
            });
            
            // Enhanced reports
            document.getElementById('generateReport').addEventListener('click', function() {
                updateEnhancedReport();
            });
            
            document.getElementById('reportType').addEventListener('change', function() {
                updateEnhancedReport();
            });
            
            // Budget recommendations
            document.getElementById('refreshRecommendations').addEventListener('click', function() {
                generateBudgetRecommendations();
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl+N: New transaction
                if (e.ctrlKey && e.key === 'n') {
                    e.preventDefault();
                    openTransactionModal();
                }
                
                // Ctrl+F: Search
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    showNotification('Fitur pencarian akan segera tersedia', 'info');
                }
                
                // Ctrl+E: Export
                if (e.ctrlKey && e.key === 'e') {
                    e.preventDefault();
                    openExportModal();
                }
                
                // Ctrl+D: Dark mode
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    document.getElementById('themeToggle').click();
                }
                
                // Ctrl+B: Budget
                if (e.ctrlKey && e.key === 'b') {
                    e.preventDefault();
                    openBudgetModal();
                }
                
                // Ctrl+G: Goals
                if (e.ctrlKey && e.key === 'g') {
                    e.preventDefault();
                    openGoalModal();
                }
                
                // Ctrl+S: Settings
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    openSettingsModal();
                }
            });
            
            // Smooth scroll for navigation links
            document.querySelectorAll('.navbar-menu a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Close mobile menu if open
                    const navbarMenu = document.getElementById('navbarMenu');
                    const menuOverlay = document.getElementById('menuOverlay');
                    
                    if (navbarMenu.classList.contains('active')) {
                        navbarMenu.classList.remove('active');
                        menuOverlay.classList.remove('active');
                    }
                    
                    // Show notification for section
                    const section = this.getAttribute('href').substring(1);
                    showNotification(`Navigasi ke ${section}`, 'info');
                });
            });
        }
        
        // Setup bottom navigation
        function setupBottomNavigation() {
            const bottomNavItems = document.querySelectorAll('.bottom-nav-item');
            
            bottomNavItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all items
                    bottomNavItems.forEach(navItem => {
                        navItem.classList.remove('active');
                    });
                    
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    // Get section name
                    const section = this.getAttribute('data-section');
                    
                    // Show notification for section
                    showNotification(`Navigasi ke ${section}`, 'info');
                    
                    // Scroll to section if it exists
                    const sectionElement = document.getElementById(section);
                    if (sectionElement) {
                        sectionElement.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        }
        
        // Setup FAB menu
        function setupFabMenu() {
            const fab = document.getElementById('fab');
            const fabMenu = document.getElementById('fabMenu');
            const fabIncome = document.getElementById('fabIncome');
            const fabExpense = document.getElementById('fabExpense');
            const fabTransfer = document.getElementById('fabTransfer');
            
            fab.addEventListener('click', function() {
                fabMenu.classList.toggle('active');
                
                // Change icon based on menu state
                const icon = this.querySelector('i');
                if (fabMenu.classList.contains('active')) {
                    icon.classList.replace('fa-plus', 'fa-times');
                } else {
                    icon.classList.replace('fa-times', 'fa-plus');
                }
            });
            
            fabIncome.addEventListener('click', function() {
                openTransactionModal('income');
                fabMenu.classList.remove('active');
                fab.querySelector('i').classList.replace('fa-times', 'fa-plus');
            });
            
            fabExpense.addEventListener('click', function() {
                openTransactionModal('expense');
                fabMenu.classList.remove('active');
                fab.querySelector('i').classList.replace('fa-times', 'fa-plus');
            });
            
            fabTransfer.addEventListener('click', function() {
                showNotification('Fitur transfer akan segera tersedia', 'info');
                fabMenu.classList.remove('active');
                fab.querySelector('i').classList.replace('fa-times', 'fa-plus');
            });
        }
        
        // Setup back to top button
        function setupBackToTop() {
            const backToTopBtn = document.getElementById('backToTop');
            
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    backToTopBtn.classList.add('visible');
                } else {
                    backToTopBtn.classList.remove('visible');
                }
            });
            
            backToTopBtn.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }
        
        // Setup navbar scroll effect
        function setupNavbarScroll() {
            const navbar = document.getElementById('navbar');
            
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 50) {
                    navbar.classList.add('scrolled');
                } else {
                    navbar.classList.remove('scrolled');
                }
            });
        }
        
        // Validate transaction form
        function validateTransactionForm() {
            const form = document.getElementById('transactionForm');
            const amount = document.getElementById('transactionAmount').value;
            const date = document.getElementById('transactionDate').value;
            const time = document.getElementById('transactionTime').value;
            const category = document.getElementById('transactionCategory').value;
            const customCategory = document.getElementById('customCategory').value;
            
            // Reset validation
            form.classList.remove('was-validated');
            
            // Check required fields
            if (!amount || !date || !time || !category) {
                form.classList.add('was-validated');
                return false;
            }
            
            // Check custom category if selected
            if (category === 'custom' && !customCategory) {
                form.classList.add('was-validated');
                return false;
            }
            
            return true;
        }
        
        // Validate budget form
        function validateBudgetForm() {
            const form = document.getElementById('budgetForm');
            const category = document.getElementById('budgetCategory').value;
            const amount = document.getElementById('budgetAmount').value;
            
            // Reset validation
            form.classList.remove('was-validated');
            
            // Check required fields
            if (!category || !amount) {
                form.classList.add('was-validated');
                return false;
            }
            
            return true;
        }
        
        // Validate goal form
        function validateGoalForm() {
            const form = document.getElementById('goalForm');
            const name = document.getElementById('goalName').value;
            const targetAmount = document.getElementById('goalTargetAmount').value;
            const currentAmount = document.getElementById('goalCurrentAmount').value;
            const targetDate = document.getElementById('goalTargetDate').value;
            
            // Reset validation
            form.classList.remove('was-validated');
            
            // Check required fields
            if (!name || !targetAmount || !currentAmount || !targetDate) {
                form.classList.add('was-validated');
                return false;
            }
            
            // Check if current amount is not greater than target
            if (parseFloat(currentAmount) > parseFloat(targetAmount)) {
                showNotification('Jumlah terkumpul tidak boleh melebihi target', 'error');
                return false;
            }
            
            return true;
        }
        
        // Validate debt form
        function validateDebtForm() {
            const form = document.getElementById('debtForm');
            const type = document.getElementById('debtType').value;
            const name = document.getElementById('debtName').value;
            const totalAmount = document.getElementById('debtTotalAmount').value;
            const amountPaid = document.getElementById('debtAmountPaid').value;
            const dueDate = document.getElementById('debtDueDate').value;
            
            // Reset validation
            form.classList.remove('was-validated');
            
            // Check required fields
            if (!type || !name || !totalAmount || !dueDate) {
                form.classList.add('was-validated');
                return false;
            }
            
            // Check if amount paid is not greater than total amount
            if (parseFloat(amountPaid) > parseFloat(totalAmount)) {
                showNotification('Jumlah dibayar tidak boleh melebihi total jumlah', 'error');
                return false;
            }
            
            return true;
        }
        
        // Open transaction modal
        function openTransactionModal(type = null) {
            const modal = document.getElementById('transactionModal');
            const modalTitle = document.getElementById('transactionModalTitle');
            
            if (type) {
                document.getElementById('transactionType').value = type;
                modalTitle.textContent = type === 'income' ? 'Tambah Pemasukan' : 'Tambah Pengeluaran';
            } else {
                modalTitle.textContent = 'Tambah Transaksi Baru';
            }
            
            modal.classList.add('visible');
        }
        
        // Close transaction modal
        function closeTransactionModal() {
            const modal = document.getElementById('transactionModal');
            modal.classList.remove('visible');
            
            // Reset form
            document.getElementById('transactionForm').reset();
            document.getElementById('transactionId').value = '';
            document.getElementById('customCategoryContainer').style.display = 'none';
            document.getElementById('recurringOptions').style.display = 'none';
            document.getElementById('recurringEndDateContainer').style.display = 'none';
        }
        
        // Open budget modal
        function openBudgetModal() {
            const modal = document.getElementById('budgetModal');
            
            // Update budget table
            updateBudgetTable();
            
            modal.classList.add('visible');
        }
        
        // Close budget modal
        function closeBudgetModal() {
            const modal = document.getElementById('budgetModal');
            modal.classList.remove('visible');
            
            // Reset form
            document.getElementById('budgetForm').reset();
            document.getElementById('budgetId').value = '';
        }
        
        // Open goal modal
        function openGoalModal() {
            const modal = document.getElementById('goalModal');
            modal.classList.add('visible');
        }
        
        // Close goal modal
        function closeGoalModal() {
            const modal = document.getElementById('goalModal');
            modal.classList.remove('visible');
            
            // Reset form
            document.getElementById('goalForm').reset();
            document.getElementById('goalId').value = '';
        }
        
        // Open debt modal
        function openDebtModal() {
            const modal = document.getElementById('debtModal');
            modal.classList.add('visible');
            
            // Set default due date to 30 days from now
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 30);
            document.getElementById('debtDueDate').value = dueDate.toISOString().split('T')[0];
        }
        
        // Close debt modal
        function closeDebtModal() {
            const modal = document.getElementById('debtModal');
            if (modal) {
                modal.classList.remove('visible');
                
                // Reset form
                document.getElementById('debtForm').reset();
                document.getElementById('debtId').value = '';
            }
        }
        
        // Open settings modal
        function openSettingsModal() {
            const modal = document.getElementById('settingsModal');
            modal.classList.add('visible');
        }
        
        // Close settings modal
        function closeSettingsModal() {
            const modal = document.getElementById('settingsModal');
            modal.classList.remove('visible');
        }
        
        // Open export modal
        function openExportModal() {
            const modal = document.getElementById('exportOptionsModal');
            modal.classList.add('visible');
        }
        
        // Close export modal
        function closeExportModal() {
            const modal = document.getElementById('exportOptionsModal');
            modal.classList.remove('visible');
        }
        
        // Open reset modal
        function openResetModal() {
            const modal = document.getElementById('resetConfirmationModal');
            modal.classList.add('visible');
        }
        
        // Close reset modal
        function closeResetModal() {
            const modal = document.getElementById('resetConfirmationModal');
            modal.classList.remove('visible');
            
            // Reset form
            document.getElementById('resetPassword').value = '';
            document.getElementById('resetPassword').classList.remove('is-invalid');
        }
        
        // Save transaction
        function saveTransaction() {
            const id = document.getElementById('transactionId').value;
            const type = document.getElementById('transactionType').value;
            const amount = parseFloat(document.getElementById('transactionAmount').value);
            const date = document.getElementById('transactionDate').value;
            const time = document.getElementById('transactionTime').value;
            let category = document.getElementById('transactionCategory').value;
            const description = document.getElementById('transactionDescription').value;
            const tags = document.getElementById('transactionTags').value;
            const isRecurring = document.getElementById('recurringTransaction').checked;
            const recurringFrequency = document.getElementById('recurringFrequency').value;
            const recurringEndDate = document.getElementById('recurringEndDate').value;
            
            // Handle custom category
            if (category === 'custom') {
                category = document.getElementById('customCategory').value.toLowerCase().replace(/\s+/g, '_');
                
                // Add color for new category
                if (!categoryColors[category]) {
                    const colors = ['#FF6384', '#36A2EB', '#4BC0C0', '#FF9F40', '#9966FF', '#C9CBCF'];
                    categoryColors[category] = colors[Math.floor(Math.random() * colors.length)];
                }
            }
            
            // Create transaction object
            const transaction = {
                id: id || Date.now().toString(),
                type,
                amount,
                date,
                time,
                category,
                description,
                tags: tags.split(',').map(tag => tag.trim()).filter(tag => tag),
                isRecurring,
                recurringFrequency: isRecurring ? recurringFrequency : null,
                recurringEndDate: isRecurring && recurringEndDate ? recurringEndDate : null
            };
            
            // Add or update transaction
            if (id) {
                // Update existing transaction
                const index = transactions.findIndex(t => t.id === id);
                if (index !== -1) {
                    transactions[index] = transaction;
                }
            } else {
                // Add new transaction
                transactions.push(transaction);
                
                // Handle recurring transactions
                if (isRecurring) {
                    // In a real app, you would schedule future transactions
                    showNotification('Transaksi berulang telah ditambahkan', 'success');
                }
            }
            
            // Save to localStorage
            saveDataToStorage();
            
            // Update dashboard
            updateDashboard();
            
            // Close modal
            closeTransactionModal();
            
            // Show success message
            showNotification(id ? 'Transaksi berhasil diperbarui' : 'Transaksi berhasil ditambahkan', 'success');
        }
        
        // Edit transaction
        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            
            if (transaction) {
                // Populate form
                document.getElementById('transactionId').value = transaction.id;
                document.getElementById('transactionType').value = transaction.type;
                document.getElementById('transactionAmount').value = transaction.amount;
                document.getElementById('transactionDate').value = transaction.date;
                document.getElementById('transactionTime').value = transaction.time;
                document.getElementById('transactionDescription').value = transaction.description;
                document.getElementById('transactionTags').value = transaction.tags.join(', ');
                
                // Set category
                if (categoryColors[transaction.category]) {
                    document.getElementById('transactionCategory').value = transaction.category;
                    document.getElementById('customCategoryContainer').style.display = 'none';
                } else {
                    document.getElementById('transactionCategory').value = 'custom';
                    document.getElementById('customCategory').value = transaction.category;
                    document.getElementById('customCategoryContainer').style.display = 'block';
                }
                
                // Set recurring options
                if (transaction.isRecurring) {
                    document.getElementById('recurringTransaction').checked = true;
                    document.getElementById('recurringFrequency').value = transaction.recurringFrequency;
                    document.getElementById('recurringOptions').style.display = 'block';
                    
                    if (transaction.recurringEndDate) {
                        document.getElementById('recurringEndDate').value = transaction.recurringEndDate;
                        document.getElementById('recurringEndDateContainer').style.display = 'block';
                    }
                }
                
                // Update modal title
                document.getElementById('transactionModalTitle').textContent = 'Edit Transaksi';
                
                // Show modal
                openTransactionModal();
            }
        }
        
        // Delete transaction
        function deleteTransaction(id) {
            if (confirm('Apakah Anda yakin ingin menghapus transaksi ini?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveDataToStorage();
                updateDashboard();
                showNotification('Transaksi berhasil dihapus', 'success');
            }
        }
        
        // Update budget table
        function updateBudgetTable() {
            const tableBody = document.getElementById('budgetTableBody');
            tableBody.innerHTML = '';
            
            if (budgets.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">Belum ada anggaran</td></tr>';
                return;
            }
            
            budgets.forEach(budget => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${getCategoryName(budget.category)}</td>
                    <td>Rp ${budget.amount.toLocaleString('id-ID')}</td>
                    <td>Rp ${budget.spent?.toLocaleString('id-ID') || '0'}</td>
                    <td>Rp ${(budget.amount - (budget.spent || 0)).toLocaleString('id-ID')}</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary edit-budget-btn" data-id="${budget.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-danger delete-budget-btn" data-id="${budget.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners
            document.querySelectorAll('.edit-budget-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const budgetId = this.getAttribute('data-id');
                    editBudget(budgetId);
                });
            });
            
            document.querySelectorAll('.delete-budget-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const budgetId = this.getAttribute('data-id');
                    deleteBudget(budgetId);
                });
            });
        }
        
        // Save budget
        function saveBudget() {
            const id = document.getElementById('budgetId').value;
            const category = document.getElementById('budgetCategory').value;
            const amount = parseFloat(document.getElementById('budgetAmount').value);
            const period = document.getElementById('budgetPeriod').value;
            const notification = document.getElementById('budgetNotification').value;
            
            // Create budget object
            const budget = {
                id: id || Date.now().toString(),
                category,
                amount,
                period,
                notification
            };
            
            // Add or update budget
            if (id) {
                // Update existing budget
                const index = budgets.findIndex(b => b.id === id);
                if (index !== -1) {
                    budgets[index] = budget;
                }
            } else {
                // Add new budget
                budgets.push(budget);
            }
            
            // Save to localStorage
            saveDataToStorage();
            
            // Update dashboard
            updateDashboard();
            
            // Close modal
            closeBudgetModal();
            
            // Show success message
            showNotification(id ? 'Anggaran berhasil diperbarui' : 'Anggaran berhasil ditambahkan', 'success');
        }
        
        // Edit budget
        function editBudget(id) {
            const budget = budgets.find(b => b.id === id);
            
            if (budget) {
                // Populate form
                document.getElementById('budgetId').value = budget.id;
                document.getElementById('budgetCategory').value = budget.category;
                document.getElementById('budgetAmount').value = budget.amount;
                document.getElementById('budgetPeriod').value = budget.period;
                document.getElementById('budgetNotification').value = budget.notification;
            }
        }
        
        // Delete budget
        function deleteBudget(id) {
            if (confirm('Apakah Anda yakin ingin menghapus anggaran ini?')) {
                budgets = budgets.filter(b => b.id !== id);
                saveDataToStorage();
                updateDashboard();
                showNotification('Anggaran berhasil dihapus', 'success');
            }
        }
        
        // Save goal
        function saveGoal() {
            const id = document.getElementById('goalId').value;
            const name = document.getElementById('goalName').value;
            const targetAmount = parseFloat(document.getElementById('goalTargetAmount').value);
            const currentAmount = parseFloat(document.getElementById('goalCurrentAmount').value);
            const targetDate = document.getElementById('goalTargetDate').value;
            const description = document.getElementById('goalDescription').value;
            
            // Create goal object
            const goal = {
                id: id || Date.now().toString(),
                name,
                targetAmount,
                currentAmount,
                targetDate,
                description
            };
            
            // Add or update goal
            if (id) {
                // Update existing goal
                const index = goals.findIndex(g => g.id === id);
                if (index !== -1) {
                    goals[index] = goal;
                }
            } else {
                // Add new goal
                goals.push(goal);
            }
            
            // Save to localStorage
            saveDataToStorage();
            
            // Update dashboard
            updateDashboard();
            
            // Close modal
            closeGoalModal();
            
            // Show success message
            showNotification(id ? 'Tujuan berhasil diperbarui' : 'Tujuan berhasil ditambahkan', 'success');
        }
        
        // Edit goal
        function editGoal(id) {
            const goal = goals.find(g => g.id === id);
            
            if (goal) {
                // Populate form
                document.getElementById('goalId').value = goal.id;
                document.getElementById('goalName').value = goal.name;
                document.getElementById('goalTargetAmount').value = goal.targetAmount;
                document.getElementById('goalCurrentAmount').value = goal.currentAmount;
                document.getElementById('goalTargetDate').value = goal.targetDate;
                document.getElementById('goalDescription').value = goal.description;
                
                // Show modal
                openGoalModal();
            }
        }
        
        // Delete goal
        function deleteGoal(id) {
            if (confirm('Apakah Anda yakin ingin menghapus tujuan ini?')) {
                goals = goals.filter(g => g.id !== id);
                saveDataToStorage();
                updateDashboard();
                showNotification('Tujuan berhasil dihapus', 'success');
            }
        }
        
        // Add to goal
        function addToGoal(id) {
            const goal = goals.find(g => g.id === id);
            
            if (goal) {
                const amount = prompt('Masukkan jumlah yang ingin ditambahkan:');
                
                if (amount && !isNaN(amount) && parseFloat(amount) > 0) {
                    const addAmount = parseFloat(amount);
                    
                    // Check if adding amount would exceed target
                    if (goal.currentAmount + addAmount > goal.targetAmount) {
                        showNotification('Jumlah yang ditambahkan melebihi target tujuan', 'error');
                        return;
                    }
                    
                    // Update goal
                    goal.currentAmount += addAmount;
                    
                    // Save to localStorage
                    saveDataToStorage();
                    
                    // Update dashboard
                    updateDashboard();
                    
                    showNotification(`Berhasil menambahkan Rp ${addAmount.toLocaleString('id-ID')} ke tujuan ${goal.name}`, 'success');
                }
            }
        }
        
        // Save debt
        function saveDebt() {
            const id = document.getElementById('debtId').value;
            const type = document.getElementById('debtType').value;
            const name = document.getElementById('debtName').value;
            const totalAmount = parseFloat(document.getElementById('debtTotalAmount').value);
            const amountPaid = parseFloat(document.getElementById('debtAmountPaid').value) || 0;
            const dueDate = document.getElementById('debtDueDate').value;
            const description = document.getElementById('debtDescription').value;
            
            // Create debt object
            const debt = {
                id: id || Date.now().toString(),
                type,
                name,
                totalAmount,
                amountPaid,
                dueDate,
                description
            };
            
            // Add or update debt
            if (id) {
                // Update existing debt
                const index = debts.findIndex(d => d.id === id);
                if (index !== -1) {
                    debts[index] = debt;
                }
            } else {
                // Add new debt
                debts.push(debt);
            }
            
            // Save to localStorage
            saveDataToStorage();
            
            // Update dashboard
            updateDashboard();
            
            // Close modal
            closeDebtModal();
            
            // Show success message
            showNotification(id ? 'Data hutang/piutang berhasil diperbarui' : 'Hutang/piutang berhasil ditambahkan', 'success');
        }
        
        // Edit debt
        function editDebt(id) {
            const debt = debts.find(d => d.id === id);
            
            if (debt) {
                // Populate form
                document.getElementById('debtId').value = debt.id;
                document.getElementById('debtType').value = debt.type;
                document.getElementById('debtName').value = debt.name;
                document.getElementById('debtTotalAmount').value = debt.totalAmount;
                document.getElementById('debtAmountPaid').value = debt.amountPaid;
                document.getElementById('debtDueDate').value = debt.dueDate;
                document.getElementById('debtDescription').value = debt.description;
            }
        }
        
        // Delete debt
        function deleteDebt(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data hutang/piutang ini?')) {
                debts = debts.filter(d => d.id !== id);
                saveDataToStorage();
                updateDashboard();
                showNotification('Data hutang/piutang berhasil dihapus', 'success');
            }
        }
        
        // Pay debt
        function payDebt(id) {
            const debt = debts.find(d => d.id === id);
            
            if (debt) {
                const remaining = debt.totalAmount - debt.amountPaid;
                const payment = prompt(`Masukkan jumlah pembayaran (Sisa: Rp ${remaining.toLocaleString('id-ID')}):`);
                
                if (payment && !isNaN(payment) && parseFloat(payment) > 0) {
                    const paymentAmount = parseFloat(payment);
                    
                    if (paymentAmount > remaining) {
                        showNotification('Jumlah pembayaran melebihi sisa hutang', 'error');
                        return;
                    }
                    
                    // Update debt
                    debt.amountPaid += paymentAmount;
                    
                    // Save to localStorage
                    saveDataToStorage();
                    
                    // Update dashboard
                    updateDashboard();
                    
                    showNotification(`Pembayaran sebesar Rp ${paymentAmount.toLocaleString('id-ID')} berhasil dicatat`, 'success');
                    
                    // If debt is fully paid, show notification
                    if (debt.amountPaid >= debt.totalAmount) {
                        showNotification(`${debt.name} telah lunas!`, 'success');
                    }
                }
            }
        }
        
        // Setup recurring transactions
        function setupRecurringTransactions() {
            // Check for due recurring transactions daily
            checkRecurringTransactions();
            
            // Set up daily check
            setInterval(checkRecurringTransactions, 86400000); // 24 hours
        }
        
        function checkRecurringTransactions() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            transactions.forEach(transaction => {
                if (transaction.isRecurring) {
                    const lastTransactionDate = new Date(transaction.date);
                    lastTransactionDate.setHours(0, 0, 0, 0);
                    
                    let nextTransactionDate = new Date(lastTransactionDate);
                    
                    // Calculate next transaction date based on frequency
                    switch (transaction.recurringFrequency) {
                        case 'daily':
                            nextTransactionDate.setDate(nextTransactionDate.getDate() + 1);
                            break;
                        case 'weekly':
                            nextTransactionDate.setDate(nextTransactionDate.getDate() + 7);
                            break;
                        case 'monthly':
                            nextTransactionDate.setMonth(nextTransactionDate.getMonth() + 1);
                            break;
                        case 'yearly':
                            nextTransactionDate.setFullYear(nextTransactionDate.getFullYear() + 1);
                            break;
                    }
                    
                    // Check if end date is set and if next transaction date is after end date
                    if (transaction.recurringEndDate) {
                        const endDate = new Date(transaction.recurringEndDate);
                        if (nextTransactionDate > endDate) {
                            return; // Skip if next transaction is after end date
                        }
                    }
                    
                    // If next transaction date is today or past, create a new transaction
                    if (nextTransactionDate <= today) {
                        const newTransaction = {
                            ...transaction,
                            id: Date.now().toString(),
                            date: nextTransactionDate.toISOString().split('T')[0],
                            time: '09:00' // Default time
                        };
                        
                        transactions.push(newTransaction);
                        saveDataToStorage();
                        
                        showNotification(`Transaksi berulang "${transaction.description}" telah ditambahkan`, 'info');
                    }
                }
            });
        }
        
        // Add recurring transaction options to form
        function addRecurringTransactionOptions() {
            const recurringOptions = document.getElementById('recurringOptions');
            const endDateContainer = document.createElement('div');
            endDateContainer.className = 'mb-3';
            endDateContainer.id = 'recurringEndDateContainer';
            endDateContainer.style.display = 'none';
            endDateContainer.innerHTML = `
                <label for="recurringEndDate" class="form-label">End Date (Optional)</label>
                <input type="date" class="form-control" id="recurringEndDate">
            `;
            
            recurringOptions.parentNode.insertBefore(endDateContainer, recurringOptions.nextSibling);
        }
        
        // Add debt section to the UI
        function addDebtSection() {
            // The debt section is already in the HTML, so we just need to set up event listeners
            document.getElementById('addDebt').addEventListener('click', function(e) {
                e.preventDefault();
                openDebtModal();
            });
        }
        
        // Add enhanced reports section
        function addEnhancedReports() {
            // Initialize enhanced report chart
            initializeEnhancedReportChart();
        }
        
        function initializeEnhancedReportChart() {
    const ctx = document.getElementById('enhancedReportChart').getContext('2d');
    
    // Remove the 'let' declaration here since we already declared it globally
    enhancedReportChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: []
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return 'Rp ' + value.toLocaleString('id-ID');
                        }
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.dataset.label + ': Rp ' + context.raw.toLocaleString('id-ID');
                        }
                    }
                }
            }
        }
    });
}
        
        function updateEnhancedReport() {
            const reportType = document.getElementById('reportType').value;
            
            switch (reportType) {
                case 'trend':
                    generateTrendReport();
                    break;
                case 'comparison':
                    generateComparisonReport();
                    break;
                case 'category':
                    generateCategoryReport();
                    break;
                case 'budget':
                    generateBudgetReport();
                    break;
            }
        }
        
        function generateTrendReport() {
            // Get last 6 months of data
            const months = [];
            const incomeData = [];
            const expenseData = [];
            const savingsData = [];
            
            const today = new Date();
            
            for (let i = 5; i >= 0; i--) {
                const date = new Date(today.getFullYear(), today.getMonth() - i, 1);
                const monthName = date.toLocaleDateString('id-ID', { month: 'short', year: 'numeric' });
                months.push(monthName);
                
                // Calculate income, expenses, and savings for this month
                let monthIncome = 0;
                let monthExpense = 0;
                
                transactions.forEach(transaction => {
                    const transactionDate = new Date(transaction.date);
                    
                    if (transactionDate.getMonth() === date.getMonth() && 
                        transactionDate.getFullYear() === date.getFullYear()) {
                        
                        if (transaction.type === 'income') {
                            monthIncome += transaction.amount;
                        } else {
                            monthExpense += transaction.amount;
                        }
                    }
                });
                
                const monthSavings = monthIncome - monthExpense;
                
                incomeData.push(monthIncome);
                expenseData.push(monthExpense);
                savingsData.push(monthSavings);
            }
            
            // Update chart
            enhancedReportChart.config.type = 'line';
            enhancedReportChart.data.labels = months;
            enhancedReportChart.data.datasets = [
                {
                    label: 'Pemasukan',
                    data: incomeData,
                    borderColor: 'rgba(76, 175, 80, 1)',
                    backgroundColor: 'rgba(76, 175, 80, 0.1)',
                    tension: 0.3,
                    fill: true
                },
                {
                    label: 'Pengeluaran',
                    data: expenseData,
                    borderColor: 'rgba(244, 67, 54, 1)',
                    backgroundColor: 'rgba(244, 67, 54, 0.1)',
                    tension: 0.3,
                    fill: true
                },
                {
                    label: 'Tabungan',
                    data: savingsData,
                    borderColor: 'rgba(33, 150, 243, 1)',
                    backgroundColor: 'rgba(33, 150, 243, 0.1)',
                    tension: 0.3,
                    fill: true
                }
            ];
            
            enhancedReportChart.update();
        }
        
        function generateComparisonReport() {
            // Compare current month with previous month
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            const previousMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const previousYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            
            // Calculate data for current month
            let currentIncome = 0;
            let currentExpense = 0;
            
            transactions.forEach(transaction => {
                const transactionDate = new Date(transaction.date);
                
                if (transactionDate.getMonth() === currentMonth && 
                    transactionDate.getFullYear() === currentYear) {
                    
                    if (transaction.type === 'income') {
                        currentIncome += transaction.amount;
                    } else {
                        currentExpense += transaction.amount;
                    }
                }
            });
            
            // Calculate data for previous month
            let previousIncome = 0;
            let previousExpense = 0;
            
            transactions.forEach(transaction => {
                const transactionDate = new Date(transaction.date);
                
                if (transactionDate.getMonth() === previousMonth && 
                    transactionDate.getFullYear() === previousYear) {
                    
                    if (transaction.type === 'income') {
                        previousIncome += transaction.amount;
                    } else {
                        previousExpense += transaction.amount;
                    }
                }
            });
            
            // Calculate percentage changes
            const incomeChange = previousIncome > 0 ? ((currentIncome - previousIncome) / previousIncome) * 100 : 0;
            const expenseChange = previousExpense > 0 ? ((currentExpense - previousExpense) / previousExpense) * 100 : 0;
            
            // Update chart
            enhancedReportChart.config.type = 'bar';
            enhancedReportChart.data.labels = ['Pemasukan', 'Pengeluaran'];
            enhancedReportChart.data.datasets = [
                {
                    label: 'Bulan Ini',
                    data: [currentIncome, currentExpense],
                    backgroundColor: ['rgba(76, 175, 80, 0.7)', 'rgba(244, 67, 54, 0.7)']
                },
                {
                    label: 'Bulan Lalu',
                    data: [previousIncome, previousExpense],
                    backgroundColor: ['rgba(76, 175, 80, 0.3)', 'rgba(244, 67, 54, 0.3)']
                }
            ];
            
            enhancedReportChart.update();
            
            // Show comparison summary
            showNotification(
                `Perbandingan Bulanan: Pemasukan ${incomeChange >= 0 ? '+' : ''}${incomeChange.toFixed(1)}%, Pengeluaran ${expenseChange >= 0 ? '+' : ''}${expenseChange.toFixed(1)}%`,
                'info'
            );
        }
        
        function generateCategoryReport() {
            // Analyze spending by category over time
            const categories = Object.keys(categoryColors);
            const months = [];
            const datasets = [];
            
            const today = new Date();
            
            // Get last 3 months
            for (let i = 2; i >= 0; i--) {
                const date = new Date(today.getFullYear(), today.getMonth() - i, 1);
                const monthName = date.toLocaleDateString('id-ID', { month: 'short', year: 'numeric' });
                months.push(monthName);
            }
            
            // Create dataset for each category
            categories.forEach(category => {
                const data = [];
                
                for (let i = 2; i >= 0; i--) {
                    const date = new Date(today.getFullYear(), today.getMonth() - i, 1);
                    let categoryTotal = 0;
                    
                    transactions.forEach(transaction => {
                        if (transaction.type === 'expense' && 
                            transaction.category === category &&
                            transactionDate.getMonth() === date.getMonth() && 
                            transactionDate.getFullYear() === date.getFullYear()) {
                            
                            categoryTotal += transaction.amount;
                        }
                    });
                    
                    data.push(categoryTotal);
                }
                
                datasets.push({
                    label: getCategoryName(category),
                    data: data,
                    backgroundColor: categoryColors[category] + '80',
                    borderColor: categoryColors[category],
                    borderWidth: 1
                });
            });
            
            // Update chart
            enhancedReportChart.config.type = 'bar';
            enhancedReportChart.data.labels = months;
            enhancedReportChart.data.datasets = datasets;
            
            enhancedReportChart.update();
        }
        
        function generateBudgetReport() {
            // Show budget performance
            const budgetNames = [];
            const budgetAmounts = [];
            const spentAmounts = [];
            
            budgets.forEach(budget => {
                budgetNames.push(getCategoryName(budget.category));
                budgetAmounts.push(budget.amount);
                
                // Calculate spent amount
                let spent = 0;
                const today = new Date();
                const currentMonth = today.getMonth();
                const currentYear = today.getFullYear();
                
                transactions.forEach(transaction => {
                    if (transaction.type === 'expense' && transaction.category === budget.category) {
                        const transactionDate = new Date(transaction.date);
                        
                        if (transactionDate.getMonth() === currentMonth && 
                            transactionDate.getFullYear() === currentYear) {
                            spent += transaction.amount;
                        }
                    }
                });
                
                spentAmounts.push(spent);
            });
            
            // Update chart
            enhancedReportChart.config.type = 'bar';
            enhancedReportChart.data.labels = budgetNames;
            enhancedReportChart.data.datasets = [
                {
                    label: 'Anggaran',
                    data: budgetAmounts,
                    backgroundColor: 'rgba(33, 150, 243, 0.7)'
                },
                {
                    label: 'Terpakai',
                    data: spentAmounts,
                    backgroundColor: 'rgba(244, 67, 54, 0.7)'
                }
            ];
            
            enhancedReportChart.update();
        }
        
        // Add budget recommendations section
        function addBudgetRecommendations() {
            // Generate initial recommendations
            generateBudgetRecommendations();
        }
        
        function generateBudgetRecommendations() {
            const recommendationsContainer = document.getElementById('recommendationsContainer');
            recommendationsContainer.innerHTML = '';
            
            // Calculate average spending by category
            const categorySpending = {};
            const categoryCount = {};
            
            transactions.forEach(transaction => {
                if (transaction.type === 'expense') {
                    if (!categorySpending[transaction.category]) {
                        categorySpending[transaction.category] = 0;
                        categoryCount[transaction.category] = 0;
                    }
                    
                    categorySpending[transaction.category] += transaction.amount;
                    categoryCount[transaction.category]++;
                }
            });
            
            // Calculate average monthly spending for each category
            const averageMonthlySpending = {};
            
            Object.keys(categorySpending).forEach(category => {
                // Get unique months for this category
                const uniqueMonths = new Set();
                
                transactions.forEach(transaction => {
                    if (transaction.type === 'expense' && transaction.category === category) {
                        const date = new Date(transaction.date);
                        const monthKey = `${date.getFullYear()}-${date.getMonth()}`;
                        uniqueMonths.add(monthKey);
                    }
                });
                
                const monthCount = uniqueMonths.size || 1;
                averageMonthlySpending[category] = categorySpending[category] / monthCount;
            });
            
            // Generate recommendations
            const recommendations = [];
            
            // Check for categories without budgets
            Object.keys(averageMonthlySpending).forEach(category => {
                const hasBudget = budgets.some(budget => budget.category === category);
                
                if (!hasBudget && averageMonthlySpending[category] > 0) {
                    recommendations.push({
                        type: 'new_budget',
                        category: category,
                        amount: averageMonthlySpending[category],
                        priority: 'medium'
                    });
                }
            });
            
            // Check for budgets that are consistently exceeded
            budgets.forEach(budget => {
                const monthsExceeded = [];
                
                // Get last 3 months
                for (let i = 2; i >= 0; i--) {
                    const date = new Date();
                    date.setMonth(date.getMonth() - i);
                    
                    let monthSpent = 0;
                    
                    transactions.forEach(transaction => {
                        if (transaction.type === 'expense' && transaction.category === budget.category) {
                            const transactionDate = new Date(transaction.date);
                            
                            if (transactionDate.getMonth() === date.getMonth() && 
                                transactionDate.getFullYear() === date.getFullYear()) {
                                
                                monthSpent += transaction.amount;
                            }
                        }
                    });
                    
                    if (monthSpent > budget.amount) {
                        monthsExceeded.push(date.toLocaleDateString('id-ID', { month: 'short' }));
                    }
                }
                
                if (monthsExceeded.length >= 2) {
                    // Calculate recommended increase (20% more than average spending)
                    const avgSpending = averageMonthlySpending[budget.category] || 0;
                    const recommendedAmount = Math.round(avgSpending * 1.2);
                    
                    recommendations.push({
                        type: 'increase_budget',
                        category: budget.category,
                        currentAmount: budget.amount,
                        recommendedAmount: recommendedAmount,
                        monthsExceeded: monthsExceeded,
                        priority: 'high'
                    });
                }
            });
            
            // Check for budgets that are consistently underutilized
            budgets.forEach(budget => {
                const monthsUnderutilized = [];
                
                // Get last 3 months
                for (let i = 2; i >= 0; i--) {
                    const date = new Date();
                    date.setMonth(date.getMonth() - i);
                    
                    let monthSpent = 0;
                    
                    transactions.forEach(transaction => {
                        if (transaction.type === 'expense' && transaction.category === budget.category) {
                            const transactionDate = new Date(transaction.date);
                            
                            if (transactionDate.getMonth() === date.getMonth() && 
                                transactionDate.getFullYear() === date.getFullYear()) {
                                
                                monthSpent += transaction.amount;
                            }
                        }
                    });
                    
                    const utilizationPercentage = (monthSpent / budget.amount) * 100;
                    
                    if (utilizationPercentage < 50) {
                        monthsUnderutilized.push(date.toLocaleDateString('id-ID', { month: 'short' }));
                    }
                }
                
                if (monthsUnderutilized.length >= 2) {
                    // Calculate recommended decrease (based on average spending + 20% buffer)
                    const avgSpending = averageMonthlySpending[budget.category] || 0;
                    const recommendedAmount = Math.round(avgSpending * 1.2);
                    
                    recommendations.push({
                        type: 'decrease_budget',
                        category: budget.category,
                        currentAmount: budget.amount,
                        recommendedAmount: recommendedAmount,
                        monthsUnderutilized: monthsUnderutilized,
                        priority: 'low'
                    });
                }
            });
            
            // Sort recommendations by priority
            recommendations.sort((a, b) => {
                const priorityOrder = { 'high': 0, 'medium': 1, 'low': 2 };
                return priorityOrder[a.priority] - priorityOrder[b.priority];
            });
            
            // Display recommendations
            if (recommendations.length === 0) {
                recommendationsContainer.innerHTML = '<p class="text-center text-muted">Tidak ada rekomendasi anggaran saat ini.</p>';
                return;
            }
            
            recommendations.forEach(recommendation => {
                const recommendationItem = document.createElement('div');
                recommendationItem.className = 'alert alert-dismissible fade show';
                
                let alertClass = 'alert-info';
                let icon = 'fa-info-circle';
                let title = 'Rekomendasi';
                
                if (recommendation.priority === 'high') {
                    alertClass = 'alert-danger';
                    icon = 'fa-exclamation-triangle';
                    title = 'Rekomendasi Penting';
                } else if (recommendation.priority === 'medium') {
                    alertClass = 'alert-warning';
                    icon = 'fa-exclamation-circle';
                    title = 'Rekomendasi';
                } else if (recommendation.priority === 'low') {
                    alertClass = 'alert-success';
                    icon = 'fa-check-circle';
                    title = 'Saran';
                }
                
                recommendationItem.className += ` ${alertClass}`;
                
                let recommendationText = '';
                let actionButton = '';
                
                if (recommendation.type === 'new_budget') {
                    recommendationText = `Pertimbangkan untuk membuat anggaran untuk kategori "${getCategoryName(recommendation.category)}". 
                                Rata-rata pengeluaran bulanan Anda adalah Rp ${recommendation.amount.toLocaleString('id-ID')}.`;
                    
                    actionButton = `<button class="btn btn-sm btn-primary create-budget-btn" data-category="${recommendation.category}" data-amount="${recommendation.amount}">
                            Buat Anggaran
                        </button>`;
                } else if (recommendation.type === 'increase_budget') {
                    recommendationText = `Anggaran untuk kategori "${getCategoryName(recommendation.category)}" sering terlampaui 
                                (${recommendation.monthsExceeded.join(', ')}). Pertimbangkan untuk meningkatkan anggaran 
                                dari Rp ${recommendation.currentAmount.toLocaleString('id-ID')} 
                                menjadi Rp ${recommendation.recommendedAmount.toLocaleString('id-ID')}.`;
                    
                    actionButton = `<button class="btn btn-sm btn-primary update-budget-btn" data-category="${recommendation.category}" data-amount="${recommendation.recommendedAmount}">
                            Perbarui Anggaran
                        </button>`;
                } else if (recommendation.type === 'decrease_budget') {
                    recommendationText = `Anggaran untuk kategori "${getCategoryName(recommendation.category)}" jarang terpakai penuh 
                                (${recommendation.monthsUnderutilized.join(', ')}). Pertimbangkan untuk mengurangi anggaran 
                                dari Rp ${recommendation.currentAmount.toLocaleString('id-ID')} 
                                menjadi Rp ${recommendation.recommendedAmount.toLocaleString('id-ID')}.`;
                    
                    actionButton = `<button class="btn btn-sm btn-primary update-budget-btn" data-category="${recommendation.category}" data-amount="${recommendation.recommendedAmount}">
                            Perbarui Anggaran
                        </button>`;
                }
                
                recommendationItem.innerHTML = `
                    <div class="d-flex">
                        <div class="me-3">
                            <i class="fas ${icon} fs-4"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="alert-heading">${title}</h5>
                            <p>${recommendationText}</p>
                            <div class="d-flex justify-content-end">
                                ${actionButton}
                                <button type="button" class="btn btn-sm btn-outline-secondary ms-2 dismiss-recommendation" data-id="${recommendation.type}-${recommendation.category}">
                                    Tutup
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                recommendationsContainer.appendChild(recommendationItem);
            });
            
            // Add event listeners
            document.querySelectorAll('.create-budget-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    const amount = this.getAttribute('data-amount');
                    
                    openBudgetModal();
                    
                    // Populate form
                    document.getElementById('budgetCategory').value = category;
                    document.getElementById('budgetAmount').value = amount;
                });
            });
            
            document.querySelectorAll('.update-budget-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    const amount = this.getAttribute('data-amount');
                    
                    // Find existing budget
                    const budget = budgets.find(b => b.category === category);
                    
                    if (budget) {
                        openBudgetModal();
                        
                        // Populate form
                        document.getElementById('budgetId').value = budget.id;
                        document.getElementById('budgetCategory').value = budget.category;
                        document.getElementById('budgetAmount').value = amount;
                        document.getElementById('budgetPeriod').value = budget.period;
                        document.getElementById('budgetNotification').value = budget.notification;
                    }
                });
            });
            
            document.querySelectorAll('.dismiss-recommendation').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.alert').remove();
                });
            });
        }
        
        // Export data
        function exportData(format, startDate, endDate) {
            let filteredTransactions = [...transactions];
            
            // Filter by date range if provided
            if (startDate && endDate) {
                filteredTransactions = filteredTransactions.filter(transaction => {
                    const transactionDate = new Date(transaction.date);
                    return transactionDate >= startDate && transactionDate <= endDate;
                });
            }
            
            if (format === 'json') {
                // Export as JSON
                const data = {
                    transactions: filteredTransactions,
                    budgets: budgets,
                    goals: goals,
                    debts: debts,
                    exportDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `finance_data_${new Date().toISOString().slice(0, 10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                showNotification('Data berhasil diekspor sebagai JSON', 'success');
            } else if (format === 'csv') {
                // Export as CSV
                let csv = 'ID,Tipe,Jumlah,Tanggal,Jam,Kategori,Deskripsi,Tags\n';
                
                filteredTransactions.forEach(transaction => {
                    csv += `${transaction.id},${transaction.type},${transaction.amount},${transaction.date},${transaction.time},${transaction.category},"${transaction.description}","${transaction.tags.join(';')}"\n`;
                });
                
                const dataUri = 'data:text/csv;charset=utf-8,'+ encodeURIComponent(csv);
                
                const exportFileDefaultName = `finance_data_${new Date().toISOString().slice(0, 10)}.csv`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                showNotification('Data berhasil diekspor sebagai CSV', 'success');
            } else if (format === 'pdf') {
                // For PDF export, we'll create a print-friendly view
                showNotification('Fitur export PDF akan segera tersedia', 'info');
            }
        }
        
        // Import data
        function importData(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    let data;
                    
                    if (file.name.endsWith('.json')) {
                        data = JSON.parse(e.target.result);
                        
                        // Handle full export format
                        if (data.transactions) {
                            // Merge with existing data
                            const existingIds = transactions.map(t => t.id);
                            const newTransactions = data.transactions.filter(t => !existingIds.includes(t.id));
                            
                            transactions = [...transactions, ...newTransactions];
                            
                            if (data.budgets) {
                                const existingBudgetIds = budgets.map(b => b.id);
                                const newBudgets = data.budgets.filter(b => !existingBudgetIds.includes(b.id));
                                
                                budgets = [...budgets, ...newBudgets];
                            }
                            
                            if (data.goals) {
                                const existingGoalIds = goals.map(g => g.id);
                                const newGoals = data.goals.filter(g => !existingGoalIds.includes(g.id));
                                
                                goals = [...goals, ...newGoals];
                            }
                            
                            if (data.debts) {
                                const existingDebtIds = debts.map(d => d.id);
                                const newDebts = data.debts.filter(d => !existingDebtIds.includes(d.id));
                                
                                debts = [...debts, ...newDebts];
                            }
                        } else {
                            // Handle transactions only format
                            const existingIds = transactions.map(t => t.id);
                            const newTransactions = data.filter(t => !existingIds.includes(t.id));
                            
                            transactions = [...transactions, ...newTransactions];
                        }
                    } else if (file.name.endsWith('.csv')) {
                        // Parse CSV
                        const lines = e.target.result.split('\n');
                        const headers = lines[0].split(',');
                        
                        data = [];
                        
                        for (let i = 1; i < lines.length; i++) {
                            if (lines[i].trim() === '') continue;
                            
                            const values = lines[i].split(',');
                            const transaction = {};
                            
                            headers.forEach((header, index) => {
                                // Clean up header name
                                const cleanHeader = header.trim().toLowerCase();
                                
                                if (cleanHeader === 'id') {
                                    transaction.id = values[index];
                                } else if (cleanHeader === 'tipe' || cleanHeader === 'type') {
                                    transaction.type = values[index];
                                } else if (cleanHeader === 'jumlah' || cleanHeader === 'amount') {
                                    transaction.amount = parseFloat(values[index]);
                                } else if (cleanHeader === 'tanggal' || cleanHeader === 'date') {
                                    transaction.date = values[index];
                                } else if (cleanHeader === 'jam' || cleanHeader === 'time') {
                                    transaction.time = values[index];
                                } else if (cleanHeader === 'kategori' || cleanHeader === 'category') {
                                    transaction.category = values[index];
                                } else if (cleanHeader === 'deskripsi' || cleanHeader === 'description') {
                                    transaction.description = values[index].replace(/"/g, '');
                                } else if (cleanHeader === 'tags') {
                                    transaction.tags = values[index].replace(/"/g, '').split(';');
                                }
                            });
                            
                            // Ensure required fields
                            if (!transaction.id) transaction.id = Date.now().toString() + Math.random().toString(36).substr(2, 5);
                            if (!transaction.tags) transaction.tags = [];
                            
                            data.push(transaction);
                        }
                        
                        // Merge with existing data
                        const existingIds = transactions.map(t => t.id);
                        const newTransactions = data.filter(t => !existingIds.includes(t.id));
                        
                        transactions = [...transactions, ...newTransactions];
                    }
                    
                    if (data && (Array.isArray(data) || data.transactions)) {
                        saveDataToStorage();
                        updateDashboard();
                        
                        const importedCount = Array.isArray(data) ? data.length : data.transactions.length;
                        showNotification(`Berhasil mengimpor ${importedCount} transaksi baru`, 'success');
                    } else {
                        showNotification('Format file tidak valid', 'error');
                    }
                } catch (error) {
                    console.error('Error importing data:', error);
                    showNotification('Gagal mengimpor data. Periksa format file.', 'error');
                }
            };
            
            reader.readAsText(file);
            
            // Reset file input
            document.getElementById('importFileInput').value = '';
        }
        
        // Check auto-delete
        function checkAutoDelete() {
            const autoDeleteEnabled = document.getElementById('autoDeleteToggle').checked;
            
            if (autoDeleteEnabled) {
                const oneYearAgo = new Date();
                oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
                
                const initialCount = transactions.length;
                transactions = transactions.filter(transaction => {
                    const transactionDate = new Date(transaction.date);
                    return transactionDate >= oneYearAgo;
                });
                
                if (transactions.length < initialCount) {
                    saveDataToStorage();
                    showNotification(`${initialCount - transactions.length} transaksi lama telah dihapus secara otomatis`, 'info');
                }
            }
        }
        
        // Get category name
        function getCategoryName(category) {
            const categoryNames = {
                food: 'Makanan',
                transport: 'Transportasi',
                salary: 'Gaji',
                shopping: 'Belanja',
                bills: 'Tagihan',
                entertainment: 'Hiburan',
                health: 'Kesehatan',
                education: 'Pendidikan',
                other: 'Lainnya'
            };
            
            return categoryNames[category] || category.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notificationContainer = document.getElementById('notificationContainer');
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'fa-info-circle';
            
            if (type === 'success') {
                icon = 'fa-check-circle';
            } else if (type === 'warning') {
                icon = 'fa-exclamation-triangle';
            } else if (type === 'error') {
                icon = 'fa-times-circle';
            }
            
            notification.innerHTML = `
                <i class="fas ${icon}"></i>
                <span>${message}</span>
            `;
            
            notificationContainer.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notificationContainer.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Auto-backup feature
        setInterval(() => {
            if (document.getElementById('autoBackup').checked) {
                saveDataToStorage();
                console.log('Auto-backup completed');
            }
        }, 60000); // Backup every minute
    </script>
</body>
</html>